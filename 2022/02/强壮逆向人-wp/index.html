<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>强壮逆向人wp - DX3906&#39;s blog</title><meta name="Description" content="DX3906&#39;s blog"><meta property="og:title" content="强壮逆向人wp" />
<meta property="og:description" content="XDSEC bbs 强壮逆向人帖 非完全wp，RE入门血泪史" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.dx39061.top/2022/02/%E5%BC%BA%E5%A3%AE%E9%80%86%E5%90%91%E4%BA%BA-wp/" /><meta property="og:image" content="https://blog.dx39061.top/images/avatar.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-08T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-02-08T00:00:00+00:00" /><meta property="og:site_name" content="DX3906&#39;s blog" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://blog.dx39061.top/images/avatar.jpg"/>

<meta name="twitter:title" content="强壮逆向人wp"/>
<meta name="twitter:description" content="XDSEC bbs 强壮逆向人帖 非完全wp，RE入门血泪史"/>
<meta name="application-name" content="DX3906&#39;s blog">
<meta name="apple-mobile-web-app-title" content="DX3906&#39;s blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://blog.dx39061.top/2022/02/%E5%BC%BA%E5%A3%AE%E9%80%86%E5%90%91%E4%BA%BA-wp/" /><link rel="next" href="https://blog.dx39061.top/2022/02/regular-expressionlinux/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "强壮逆向人wp",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/blog.dx39061.top\/2022\/02\/%E5%BC%BA%E5%A3%AE%E9%80%86%E5%90%91%E4%BA%BA-wp\/"
        },"genre": "posts","keywords": "CTF, reverse","wordcount":  9843 ,
        "url": "https:\/\/blog.dx39061.top\/2022\/02\/%E5%BC%BA%E5%A3%AE%E9%80%86%E5%90%91%E4%BA%BA-wp\/","datePublished": "2022-02-08T00:00:00+00:00","dateModified": "2022-02-08T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "dx3906"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="DX3906&#39;s blog"><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/">< 归档 ></a><a class="menu-item" href="/tags/">< 标签 ></a><a class="menu-item" href="/categories/">< 分类 ></a><a class="menu-item" href="/links">< 友链 ></a><a class="menu-item" href="/about">< 关于 ></a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="DX3906&#39;s blog"><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title=""><归档></a><a class="menu-item" href="/tags/" title=""><标签></a><a class="menu-item" href="/categories/" title=""><分类></a><a class="menu-item" href="/links" title=""><友链></a><a class="menu-item" href="/about" title=""><关于></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">强壮逆向人wp</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/DX39061" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>dx3906</a></span>&nbsp;<span class="post-category">included in <a href="/categories/writeups/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>WriteUps</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2022-02-08">2022-02-08</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;9843 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;47 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#0x00-hacking-with-google-beginner">0x00 Hacking with Google: Beginner</a></li>
    <li><a href="#0x01-vn-公开赛-csre">0x01 V&amp;N 公开赛 CSRe</a></li>
    <li><a href="#0x02-zer0pts2020-easy-strcmp">0x02 Zer0pts2020 easy-strcmp</a></li>
  </ul>

  <ul>
    <li><a href="#0x00-大佬喝茶">0x00 大佬喝茶~</a></li>
    <li><a href="#0x01-n1ctf-oflo">0x01 N1CTF oflo</a></li>
    <li><a href="#0x02-xnuca-2020-unravel-mfc">0x02 XNUCA 2020 Unravel MFC</a></li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#000-guetctf-2019-number-game">0×00 GUETCTF 2019 number game</a></li>
      </ul>
    </li>
    <li><a href="#0x01-hitctf-2020-node">0x01 HITCTF 2020 Node</a>
      <ul>
        <li><a href="#002-gkctf-2020-babydriver">0×02 GKCTF 2020 BabyDriver</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#000-pydis">0×00 PyDis</a></li>
      </ul>
    </li>
    <li><a href="#001-flareon4-igniteme">0×01 FlareOn4 IgniteMe</a></li>
    <li><a href="#0x02-buuctf-firmware">0x02 BUUCTF Firmware</a></li>
  </ul>

  <ul>
    <li><a href="#0x00-ddctf-android-easy">0x00 DDCTF Android Easy</a></li>
    <li><a href="#0x01-welcome-to-jni">0x01 WELCOME TO JNI</a></li>
    <li><a href="#0x02-codegate-ctf-redvelvet">0x02 Codegate CTF Redvelvet</a></li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#0x00-dmctf2020-re3">0x00 DMCTF2020 re3</a></li>
      </ul>
    </li>
    <li><a href="#0x01-actf2020-oruga">0x01 ACTF2020 Oruga</a></li>
    <li><a href="#002-网鼎杯2020-signal">0×02 网鼎杯2020 signal</a></li>
  </ul>

  <ul>
    <li><a href="#000-suctf2019-signin">0×00 SUCTF2019 Signin</a></li>
    <li><a href="#001-flareon6-overlang">0×01 FlareOn6 Overlang</a>
      <ul>
        <li><a href="#002-bjdctf2020-easy">0×02 BJDCTF2020 easy</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#000-从-cnss-偷来的-smc">0×00 从 CNSS 偷来的 SMC</a></li>
    <li><a href="#001-bytectf-2020-awd">0×01 ByteCTF 2020 AWD</a></li>
    <li><a href="#002-bjdctf-2020-老八的小汉堡">0×02 BJDCTF 2020 老八的小汉堡</a></li>
  </ul>

  <ul>
    <li><a href="#0x00-dmctf-2020-re1">0x00 DMCTF 2020 re1</a>
      <ul>
        <li><a href="#0x01-dmctf-2020-re4">0x01 DMCTF 2020 re4</a></li>
      </ul>
    </li>
    <li><a href="#0x02-gwctf-2019-xxor">0x02 GWCTF 2019 xxor</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="第九周">第九周</h1>
<h2 id="0x00-hacking-with-google-beginner">0x00 Hacking with Google: Beginner</h2>
<p>做了一半卡住了，偷看了一下<a href="https://github.com/luker983/google-ctf-2020/tree/master/reversing/beginner" target="_blank" rel="noopener noreffer ">官方题解</a>，然后复现一下</p>
<p>ida很容易定位到主函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// er12
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__m128i</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [rsp+0h] [rbp-38h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__m128i</span> <span class="n">s2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="c1">// [rsp+10h] [rbp-28h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Flag: &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">__isoc99_scanf</span><span class="p">(</span><span class="s">&#34;%15s&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">s2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nf">_mm_xor_si128</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="nf">_mm_add_epi32</span><span class="p">(</span><span class="nf">_mm_shuffle_epi8</span><span class="p">(</span><span class="nf">_mm_load_si128</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v5</span><span class="p">),</span> <span class="p">(</span><span class="kr">__m128i</span><span class="p">)</span><span class="n">SHUFFLE</span><span class="p">),</span> <span class="p">(</span><span class="kr">__m128i</span><span class="p">)</span><span class="n">ADD32</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="kr">__m128i</span><span class="p">)</span><span class="n">XOR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nf">strncmp</span><span class="p">(</span><span class="n">v5</span><span class="p">.</span><span class="n">m128i_i8</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">s2</span><span class="p">,</span> <span class="mh">0x10uLL</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">v3</span> <span class="o">=</span> <span class="nf">strncmp</span><span class="p">((</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">s2</span><span class="p">,</span> <span class="n">EXPECTED_PREFIX</span><span class="p">,</span> <span class="mi">4uLL</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;SUCCESS&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v3</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;FAILURE&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">v3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到各种SSE指令</p>
<p>这里要注意add是把每四字节打包（pack）然后进行求和，而异或是逐字节进行异或</p>
<p><a href="https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html#text=_mm_shuffle_epi8&amp;ig_expand=7491,6382,4290,101,6382,7491,101" target="_blank" rel="noopener noreffer ">_mm_shuffle_epi8</a> 无法见名知义，官方描述加查找各种解释终于搞懂，见注释</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">FOR</span> <span class="nl">j</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">15</span>        <span class="c1">//遍历16个字节
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">i</span> <span class="p">:</span><span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="mi">8</span>        <span class="c1">//遍历每个字节中的8个bit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">IF</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>        <span class="c1">//当前字节最高位为1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">dst</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="o">:</span><span class="n">i</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">0</span> <span class="c1">//整个字节8bit全置为0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ELSE</span>
</span></span><span class="line"><span class="cl">        <span class="n">index</span><span class="p">[</span><span class="mi">3</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="o">:=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="o">:</span><span class="n">i</span><span class="p">]</span>    <span class="c1">//相当于以int形式取出b中的值存入index
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">dst</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="o">:</span><span class="n">i</span><span class="p">]</span> <span class="o">:=</span> <span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="mi">7</span><span class="o">:</span><span class="n">index</span><span class="o">*</span><span class="mi">8</span><span class="p">]</span>  <span class="c1">//把a数组下标为index[i]的值放入dst数组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">FI</span>
</span></span><span class="line"><span class="cl"><span class="n">ENDFOR</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>由于可见字符为32-126，不可能最高位为1，所以全置为0的情况不会发生</p>
<p>即shuffle就是把原数组a按b的顺序重新排列了一遍，其中值没有改变</p>
<p>题目验证逻辑</p>
<p><code>flag-&gt;shuffle-&gt;add-&gt;xor == flag</code> &amp;&amp; flag前四位为<code>CTF{</code> （这里注意输入的第16位是字符串结束标志\0</p>
<p>显然我们可以根据前四位推出一些东西</p>
<p>从后往前推</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">flag</span>    <span class="mh">0x43</span>  <span class="mh">0x54</span>  <span class="mh">0x46</span>  <span class="mh">0x7b</span>
</span></span><span class="line"><span class="cl"><span class="n">xornum</span>  <span class="mh">0x76</span>  <span class="mh">0x58</span>  <span class="mh">0xB4</span>  <span class="mh">0x49</span>
</span></span><span class="line"><span class="cl"><span class="n">xor_pre</span> <span class="mh">0x35</span>  <span class="mh">0x0c</span>  <span class="mh">0xf2</span>  <span class="mh">0x32</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">xor_pre</span> <span class="mh">0x32f20c35</span>  
</span></span><span class="line"><span class="cl"><span class="n">addnum</span>  <span class="mh">0x0DEADBEEF</span>
</span></span><span class="line"><span class="cl"><span class="n">add_pre</span> <span class="mh">0x54444d46</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">add_pre</span>     <span class="mh">0x46</span>  <span class="mh">0x4d</span>  <span class="mh">0x44</span>  <span class="mh">0x54</span>
</span></span><span class="line"><span class="cl"><span class="n">shufflenum</span>  <span class="mi">2</span>     <span class="mi">6</span>      <span class="mi">7</span>     <span class="mi">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>于是我们知道了第6、7位分别为M、D，即<code>CTF{--MD------}\0</code></p>
<p>这时我们想到，最低位（字节）的值进行add操作时不会受其他字节的影响（不会受进位的影响</p>
<p>要确保已知字符是shuffle后的最低位，我们想到了\0，并且这次需要正着推</p>
<p>为省事写个脚本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="n">xornum</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mh">0xB4</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x8D</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">,</span> <span class="mh">0x5F</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0xD4</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0xF8</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0xEB</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0xF9</span><span class="p">,</span> <span class="mh">0xAA</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">addnum</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0xEF</span><span class="p">,</span> <span class="mh">0xBE</span><span class="p">,</span> <span class="mh">0xAD</span><span class="p">,</span> <span class="mh">0xDE</span><span class="p">,</span> <span class="mh">0xAD</span><span class="p">,</span> <span class="mh">0xDE</span><span class="p">,</span> <span class="mh">0xE1</span><span class="p">,</span> <span class="mh">0xFE</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">shufflenum</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">alpha</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="n">pre_index</span><span class="p">;</span>    <span class="c1">//index是shuffle之后的下标，pre_index是shuffle之前的下标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%x%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">alpha</span><span class="p">,</span><span class="o">&amp;</span><span class="n">index</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">index</span><span class="o">==</span><span class="n">shufflenum</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">pre_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">newalpha</span> <span class="o">=</span> <span class="p">((</span><span class="n">alpha</span><span class="o">+</span><span class="n">addnum</span><span class="p">[</span><span class="n">pre_index</span><span class="p">]))</span><span class="o">^</span><span class="n">xornum</span><span class="p">[</span><span class="n">pre_index</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;0x%x %c %d&#34;</span><span class="p">,</span><span class="n">newalpha</span><span class="p">,</span><span class="n">newalpha</span><span class="p">,</span><span class="n">pre_index</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// input:0 15
</span></span></span><span class="line"><span class="cl"><span class="c1">// output:0x30 0 9
</span></span></span><span class="line"><span class="cl"><span class="c1">// input:0x7b 3
</span></span></span><span class="line"><span class="cl"><span class="c1">// output:0x66 f 8
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>于是得到了flag第九位为0，即<code>CTF{--MD-0----}\0</code></p>
<p>同样用 { 可以得到第8位为 f，即<code>CTF{--MDf0----}\0</code></p>
<p>但我们已经用完了所有的最低字节</p>
<p>我们如果使用其他字节就会面临进位的问题，但我们也不排除还有其他没有使用的，没有进位的字符</p>
<p>如果去考虑一遍所有的位是否存在进位问题是一个浩大的工程</p>
<p>所以我们的想法是碰碰运气，如果推出的字符与已知矛盾就舍弃，如果不矛盾就保留（这真是官方方法</p>
<p>在把所有位试过一遍之后，我们会逐渐得到flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">CTF</span><span class="p">{</span><span class="o">--</span><span class="n">MDf0</span><span class="o">-</span><span class="n">M</span><span class="o">--</span><span class="p">}</span><span class="err">\</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">CTF</span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="n">MDf0</span><span class="o">-</span><span class="n">M</span><span class="o">--</span><span class="p">}</span><span class="err">\</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">CTF</span><span class="p">{</span><span class="n">S1MDf0</span><span class="o">-</span><span class="n">M</span><span class="o">--</span><span class="p">}</span><span class="err">\</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">CTF</span><span class="p">{</span><span class="n">S1MDf0rM</span><span class="o">--</span><span class="p">}</span><span class="err">\</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">CTF</span><span class="p">{</span><span class="n">S1MDf0rM3</span><span class="o">-</span><span class="p">}</span><span class="err">\</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">CTF</span><span class="p">{</span><span class="n">S1MDf0rM3</span><span class="o">!</span><span class="p">}</span><span class="err">\</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">CTF</span><span class="p">{</span><span class="n">S1MDf0rM3</span><span class="o">!</span><span class="p">}</span><span class="err">\</span><span class="mi">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="0x01-vn-公开赛-csre">0x01 V&amp;N 公开赛 CSRe</h2>
<p>die查，发现protector: Eazfuscator</p>
<p>查了一下，是一种.Net代码混淆方法，可以用de4dot反混淆，然后dnspy反编译</p>
<p>这道题需要耐心，尝试搜索flag字符串，翻了十多分钟终于找到Main</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Token: 0x02000006 RID: 6</span>
</span></span><span class="line"><span class="cl"><span class="k">internal</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Class3</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Token: 0x0600000D RID: 13 RVA: 0x000022C8 File Offset: 0x000004C8</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="kt">string</span> <span class="n">method_0</span><span class="p">(</span><span class="kt">string</span> <span class="n">string_0</span><span class="p">,</span> <span class="kt">string</span> <span class="n">string_1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">string</span> <span class="n">text</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">char</span><span class="p">[]</span> <span class="n">array</span> <span class="p">=</span> <span class="n">string_0</span><span class="p">.</span><span class="n">ToCharArray</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">char</span><span class="p">[]</span> <span class="n">array2</span> <span class="p">=</span> <span class="n">string_1</span><span class="p">.</span><span class="n">ToCharArray</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">num</span> <span class="p">=</span> <span class="p">(</span><span class="n">array</span><span class="p">.</span><span class="n">Length</span> <span class="p">&lt;</span> <span class="n">array2</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span> <span class="p">?</span> <span class="n">array</span><span class="p">.</span><span class="n">Length</span> <span class="p">:</span> <span class="n">array2</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">num</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">text</span> <span class="p">+=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">^</span> <span class="n">array2</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Token: 0x0600000E RID: 14 RVA: 0x0000231C File Offset: 0x0000051C</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">smethod_0</span><span class="p">(</span><span class="kt">string</span> <span class="n">string_0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">byte</span><span class="p">[]</span> <span class="n">bytes</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">string_0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">byte</span><span class="p">[]</span> <span class="n">array</span> <span class="p">=</span> <span class="n">SHA1</span><span class="p">.</span><span class="n">Create</span><span class="p">().</span><span class="n">ComputeHash</span><span class="p">(</span><span class="n">bytes</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">StringBuilder</span> <span class="n">stringBuilder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="kt">byte</span> <span class="n">b</span> <span class="k">in</span> <span class="n">array</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">stringBuilder</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">ToString</span><span class="p">(</span><span class="s">&#34;X2&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">stringBuilder</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Token: 0x0600000F RID: 15 RVA: 0x00002374 File Offset: 0x00000574</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="n">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(!</span><span class="n">Class1</span><span class="p">.</span><span class="n">smethod_1</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kt">bool</span> <span class="n">flag</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Class3</span> <span class="n">@class</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Class3</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">string</span> <span class="n">str</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">Class3</span><span class="p">.</span><span class="n">smethod_0</span><span class="p">(</span><span class="s">&#34;3&#34;</span> <span class="p">+</span> <span class="n">str</span> <span class="p">+</span> <span class="s">&#34;9&#34;</span><span class="p">)</span> <span class="p">!=</span> <span class="s">&#34;B498BFA2498E21325D1178417BEA459EB2CD28F8&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">flag</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kt">string</span> <span class="n">text</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">string</span> <span class="n">string_</span> <span class="p">=</span> <span class="n">Class3</span><span class="p">.</span><span class="n">smethod_0</span><span class="p">(</span><span class="s">&#34;re&#34;</span> <span class="p">+</span> <span class="n">text</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">string</span> <span class="n">text2</span> <span class="p">=</span> <span class="n">@class</span><span class="p">.</span><span class="n">method_0</span><span class="p">(</span><span class="n">string_</span><span class="p">,</span> <span class="s">&#34;63143B6F8007B98C53CA2149822777B3566F9241&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">text2</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">text2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">!=</span> <span class="sc">&#39;0&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">flag</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;flag{&#34;</span> <span class="p">+</span> <span class="n">str</span> <span class="p">+</span> <span class="n">text</span> <span class="p">+</span> <span class="s">&#34;}&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到flag由两部分组成，即str和text</p>
<p>class。method_0像是个加密算法，得到两串字符串</p>
<p>直接丢到Cmd5网站解密，原来是Sha1加密</p>
<p>得到<code>&quot;3&quot; + str + &quot;9&quot;</code>==314159,<code>&quot;re&quot; + text</code> ==return</p>
<p>故flag{1415turn}</p>
<h2 id="0x02-zer0pts2020-easy-strcmp">0x02 Zer0pts2020 easy-strcmp</h2>
<p>ida载入，main函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="n">__int64</span> <span class="n">__fastcall</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">char</span> <span class="p">**</span><span class="n">a2</span><span class="p">,</span> <span class="kt">char</span> <span class="p">**</span><span class="n">a3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">a1</span> <span class="p">&gt;</span> <span class="m">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="p">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">a2</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="s">&#34;zer0pts{********CENSORED********}&#34;</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Correct!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">      <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Wrong!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Usage: %s &lt;FLAG&gt;\n&#34;</span><span class="p">,</span> <span class="p">*</span><span class="n">a2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="m">0L</span><span class="n">L</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>醒目的strcmp和一串字符串，难道这就是flag？肯定不是</p>
<p>翻函数列表发现两个特别的函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="kt">int</span> <span class="p">(**</span><span class="n">sub_563477E00795</span><span class="p">())(</span><span class="k">const</span> <span class="kt">char</span> <span class="p">*</span><span class="n">s1</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="p">*</span><span class="n">s2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="p">(**</span><span class="n">result</span><span class="p">)(</span><span class="k">const</span> <span class="kt">char</span> <span class="p">*,</span> <span class="k">const</span> <span class="kt">char</span> <span class="p">*);</span> <span class="c1">// rax</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">result</span> <span class="p">=</span> <span class="p">&amp;</span><span class="n">strcmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">qword_563478001090</span> <span class="p">=</span> <span class="p">(</span><span class="n">__int64</span> <span class="p">(</span><span class="n">__fastcall</span> <span class="p">*)(</span><span class="n">_QWORD</span><span class="p">,</span> <span class="n">_QWORD</span><span class="p">))&amp;</span><span class="n">strcmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">off_563478001028</span> <span class="p">=</span> <span class="n">sub_563477E006EA</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="n">__int64</span> <span class="n">__fastcall</span> <span class="n">sub_563477E006EA</span><span class="p">(</span><span class="n">__int64</span> <span class="n">a1</span><span class="p">,</span> <span class="n">__int64</span> <span class="n">a2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-8h]</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-8h]</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">j</span><span class="p">;</span> <span class="c1">// [rsp+1Ch] [rbp-4h]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="p">*(</span><span class="n">_BYTE</span> <span class="p">*)(</span><span class="n">i</span> <span class="p">+</span> <span class="n">a1</span><span class="p">);</span> <span class="p">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v4</span> <span class="p">=</span> <span class="p">(</span><span class="n">i</span> <span class="p">&gt;&gt;</span> <span class="m">3</span><span class="p">)</span> <span class="p">+</span> <span class="m">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">v4</span><span class="p">;</span> <span class="p">++</span><span class="n">j</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">*(</span><span class="n">_QWORD</span> <span class="p">*)(</span><span class="m">8</span> <span class="p">*</span> <span class="n">j</span> <span class="p">+</span> <span class="n">a1</span><span class="p">)</span> <span class="p">-=</span> <span class="n">qword_563478001060</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">qword_563478001090</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到第一个函数sub_563477E00795记录了strcmp函数的地址，然后调用了函数sub_563477E006EA</p>
<p>相当于把strcmp函数给改了，实际执行的是第二个函数sub_563477E006EA</p>
<p>即把真正的flag加密了，然后与main函数里的字符串比较</p>
<p>这里注意main函数里传的是 a2[1]，即跳过了zer0pts</p>
<p>qword_563478001060刚好32个字节非空，对应修改 * 及其中间字符共32个字节</p>
<p>于是写脚本拿flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="err">#</span><span class="n">include</span><span class="p">&lt;</span><span class="n">stdio</span><span class="p">.</span><span class="n">h</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">unsigned</span> <span class="kt">char</span> <span class="n">key</span><span class="p">[]</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="m">0x42</span><span class="p">,</span> <span class="m">0x09</span><span class="p">,</span> <span class="m">0x4A</span><span class="p">,</span> <span class="m">0x49</span><span class="p">,</span> <span class="m">0x35</span><span class="p">,</span> <span class="m">0x43</span><span class="p">,</span> <span class="m">0x0A</span><span class="p">,</span> <span class="m">0x41</span><span class="p">,</span> <span class="m">0xF0</span><span class="p">,</span> <span class="m">0x19</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">  <span class="m">0xE6</span><span class="p">,</span> <span class="m">0x0B</span><span class="p">,</span> <span class="m">0xF5</span><span class="p">,</span> <span class="m">0xF2</span><span class="p">,</span> <span class="m">0x0E</span><span class="p">,</span> <span class="m">0x0B</span><span class="p">,</span> <span class="m">0x2B</span><span class="p">,</span> <span class="m">0x28</span><span class="p">,</span> <span class="m">0x35</span><span class="p">,</span> <span class="m">0x4A</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">  <span class="m">0x06</span><span class="p">,</span> <span class="m">0x3A</span><span class="p">,</span> <span class="m">0x0A</span><span class="p">,</span> <span class="m">0x4F</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span> <span class="n">en_flag</span><span class="p">[]=</span><span class="s">&#34;********CENSORED********&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">flag</span><span class="p">[</span><span class="m">5</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">=</span><span class="m">0</span><span class="p">;</span><span class="n">i</span><span class="p">&lt;</span><span class="m">3</span><span class="p">;</span><span class="n">i</span><span class="p">++){</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]=*((</span><span class="n">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="p">*)</span><span class="n">key</span><span class="p">+</span><span class="n">i</span><span class="p">)+*((</span><span class="n">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="p">*)</span><span class="n">en_flag</span><span class="p">+</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">=</span><span class="m">0</span><span class="p">;</span><span class="n">i</span><span class="p">&lt;</span><span class="m">24</span><span class="p">;</span><span class="n">i</span><span class="p">++){</span>
</span></span><span class="line"><span class="cl">        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%c&#34;</span><span class="p">,*((</span><span class="n">unsigned</span> <span class="kt">char</span> <span class="p">*)</span><span class="n">flag</span><span class="p">+</span><span class="n">i</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//zer0pts{l3ts_m4k3_4_DETOUR_t0d4y}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>刚开始还犯了错误，逐字节解密得到错误flag：<code>l3ts_m4k3^4^DDSOUR_t0d4y</code></p>
<p>因为题目是将每8字节打包进行加法，其中有进位，而逐字节加法不会产生进位，所以出了问题</p>
<h1 id="第八周">第八周</h1>
<h2 id="0x00-大佬喝茶">0x00 大佬喝茶~</h2>
<p>偷懒没有管花指令</p>
<p>ida载入，进main函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a2</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">j</span><span class="p">;</span> <span class="c1">// [rsp+14h] [rbp-7Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-78h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">input</span><span class="p">[</span><span class="mi">48</span><span class="p">];</span> <span class="c1">// [rsp+20h] [rbp-70h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v7</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span> <span class="c1">// [rsp+50h] [rbp-40h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v8</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span> <span class="c1">// [rsp+70h] [rbp-20h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v8</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nf">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v8</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x4837F6D54BAA4D13LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v8</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x203F4E88752F3489LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Hello there. Plz Input your flag: &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">__isoc99_scanf</span><span class="p">(</span><span class="s">&#34;%40s&#34;</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="nf">strlen</span><span class="p">(</span><span class="n">input</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">32</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;nope</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">v7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">((</span><span class="kt">void</span> <span class="p">(</span><span class="kr">__fastcall</span> <span class="o">*</span><span class="p">)(</span><span class="kr">__int64</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kr">__int64</span><span class="p">))</span><span class="n">sub_1180</span><span class="p">)(</span><span class="n">v8</span><span class="p">,</span> <span class="n">v7</span><span class="p">,</span> <span class="mi">4LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">v7</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="n">en_flag</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;nope</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;you are right!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看出就是把input复制给v7然后经sub_1180函数加密然后和en_flag比较</p>
<p>跟进sub_1180</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">sub_1180</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">a1</span><span class="p">,</span> <span class="kr">__int64</span> <span class="n">a2</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+0h] [rbp-4Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [rsp+4h] [rbp-48h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [rsp+8h] [rbp-44h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [rsp+Ch] [rbp-40h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span><span class="p">;</span> <span class="c1">// [rsp+14h] [rbp-38h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-34h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// [rsp+1Ch] [rbp-30h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v11</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-2Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v12</span><span class="p">;</span> <span class="c1">// [rsp+24h] [rbp-28h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span> <span class="o">=</span> <span class="nf">_byteswap_ulong</span><span class="p">(</span><span class="o">*</span><span class="n">a1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span> <span class="o">=</span> <span class="nf">_byteswap_ulong</span><span class="p">(</span><span class="n">a1</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span> <span class="o">=</span> <span class="nf">_byteswap_ulong</span><span class="p">(</span><span class="n">a1</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v4</span> <span class="o">=</span> <span class="nf">_byteswap_ulong</span><span class="p">(</span><span class="n">a1</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">a3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v10</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">v12</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">v11</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mh">0x20</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">v10</span> <span class="o">-=</span> <span class="mi">1640531527</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">v12</span> <span class="o">+=</span> <span class="p">(</span><span class="n">v6</span> <span class="o">+</span> <span class="p">(</span><span class="n">v11</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">))</span> <span class="o">^</span> <span class="p">(</span><span class="n">v10</span> <span class="o">+</span> <span class="n">v11</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">v7</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">*</span> <span class="n">v11</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">v11</span> <span class="o">+=</span> <span class="p">(</span><span class="n">v4</span> <span class="o">+</span> <span class="p">(</span><span class="n">v12</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">))</span> <span class="o">^</span> <span class="p">(</span><span class="n">v10</span> <span class="o">+</span> <span class="n">v12</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">v5</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">*</span> <span class="n">v12</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="nf">HIBYTE</span><span class="p">(</span><span class="n">v12</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nf">BYTE2</span><span class="p">(</span><span class="n">v12</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="nf">BYTE1</span><span class="p">(</span><span class="n">v12</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">v12</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="nf">HIBYTE</span><span class="p">(</span><span class="n">v11</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="nf">BYTE2</span><span class="p">(</span><span class="n">v11</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="nf">BYTE1</span><span class="p">(</span><span class="n">v11</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="n">v11</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>能看出来就是tea加密</p>
<p>_byteswap_ulong这个细节需要注意，用处是把参数值以字节为单位颠倒前后顺序，也可以直接动调得到，即为key密钥</p>
<p>写脚本拿flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">en_flag</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">=</span><span class="p">{</span><span class="mi">104</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">183</span><span class="p">,</span><span class="mi">126</span><span class="p">,</span><span class="mi">253</span><span class="p">,</span><span class="mi">224</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">184</span><span class="p">,</span><span class="mi">177</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">193</span><span class="p">,</span><span class="mi">252</span><span class="p">,</span><span class="mi">91</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">195</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">92</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">185</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mi">154</span><span class="p">,</span><span class="mi">107</span><span class="p">,</span><span class="mi">135</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">206</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">106</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">107</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">// int key[]={0x4BAA4D13,0x4837F6D5,0x752F3489,0x203F4E88};
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="mh">0x134daa4b</span><span class="p">,</span><span class="mh">0xd5f63748</span><span class="p">,</span><span class="mh">0x89342f75</span><span class="p">,</span><span class="mh">0x884e3f20</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">delta</span> <span class="o">=</span><span class="mh">0x61C88647</span><span class="p">,</span><span class="n">v9</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">flag</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v10</span><span class="p">,</span><span class="n">v11</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v11</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">=*</span><span class="p">(</span><span class="n">en_flag</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v11</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">=*</span><span class="p">(</span><span class="n">en_flag</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v11</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">=*</span><span class="p">(</span><span class="n">en_flag</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v11</span><span class="p">)</span><span class="o">=*</span><span class="p">(</span><span class="n">en_flag</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v10</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">=*</span><span class="p">(</span><span class="n">en_flag</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v10</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">=*</span><span class="p">(</span><span class="n">en_flag</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v10</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">=*</span><span class="p">(</span><span class="n">en_flag</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v10</span><span class="p">)</span><span class="o">=*</span><span class="p">(</span><span class="n">en_flag</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mh">0x20</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">--</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="n">v9</span><span class="o">=</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">delta</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">v10</span> <span class="o">-=</span> <span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">v11</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">))</span> <span class="o">^</span> <span class="p">(</span><span class="n">v9</span> <span class="o">+</span> <span class="n">v11</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">*</span> <span class="n">v11</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">v11</span> <span class="o">-=</span> <span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">v10</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">))</span> <span class="o">^</span> <span class="p">(</span><span class="n">v9</span> <span class="o">+</span> <span class="n">v10</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">*</span> <span class="n">v10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="p">(</span><span class="n">flag</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v11</span><span class="o">+</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="p">(</span><span class="n">flag</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v11</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="p">(</span><span class="n">flag</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v11</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="p">(</span><span class="n">flag</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v11</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="p">(</span><span class="n">flag</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v10</span><span class="o">+</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="p">(</span><span class="n">flag</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v10</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="p">(</span><span class="n">flag</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v10</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="p">(</span><span class="n">flag</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="n">flag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//19d9346d-410a-441f-b14e-9a60bb05
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="0x01-n1ctf-oflo">0x01 N1CTF oflo</h2>
<p>太难啦~ 根据RX的wp复现还遇到了好多问题（（</p>
<p>ida打开只能看到start函数，点开offset main看到main函数全是红的，分析错误</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-fbb373ae1eca4665b1cef05045427137.png"
        data-srcset="/upload/2022/02/image-fbb373ae1eca4665b1cef05045427137.png, /upload/2022/02/image-fbb373ae1eca4665b1cef05045427137.png 1.5x, /upload/2022/02/image-fbb373ae1eca4665b1cef05045427137.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-fbb373ae1eca4665b1cef05045427137.png"
        title="image" /></p>
<p>400BB1 jmp那一行明显有花指令，loc_400BB1自己跳到自己，先按u取消定义，BB2那一行按c转换为code，BB1patch成nop</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-69e2f7caab3b4905b28f5fa685a7d0f3.png"
        data-srcset="/upload/2022/02/image-69e2f7caab3b4905b28f5fa685a7d0f3.png, /upload/2022/02/image-69e2f7caab3b4905b28f5fa685a7d0f3.png 1.5x, /upload/2022/02/image-69e2f7caab3b4905b28f5fa685a7d0f3.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-69e2f7caab3b4905b28f5fa685a7d0f3.png"
        title="image" /></p>
<p>BB7跳转到loc_400BBF，然后胡乱操作一通就retn了</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-8b40c0b9f4ca42f697e2626b4b628ec8.png"
        data-srcset="/upload/2022/02/image-8b40c0b9f4ca42f697e2626b4b628ec8.png, /upload/2022/02/image-8b40c0b9f4ca42f697e2626b4b628ec8.png 1.5x, /upload/2022/02/image-8b40c0b9f4ca42f697e2626b4b628ec8.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-8b40c0b9f4ca42f697e2626b4b628ec8.png"
        title="image" /></p>
<p>因为return以后要执行BBC这一行，所以BBC这一行应该也是花指令</p>
<p>按u取消定义，把BBC patch掉，剩下两行转换成code，400CBA那一行同理</p>
<p>400D04和上面BB1同理，一样搞掉</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-242489444cb7441191832732b0bbf01e.png"
        data-srcset="/upload/2022/02/image-242489444cb7441191832732b0bbf01e.png, /upload/2022/02/image-242489444cb7441191832732b0bbf01e.png 1.5x, /upload/2022/02/image-242489444cb7441191832732b0bbf01e.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-242489444cb7441191832732b0bbf01e.png"
        title="image" /></p>
<p>D14下面这几行一堆乱数据，不知道有没有用，先不管</p>
<p>回到main函数开头按p创建函数，成功，F5却出现报错</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-3605ccc5f5bd43e19468184e970b44ce.png"
        data-srcset="/upload/2022/02/image-3605ccc5f5bd43e19468184e970b44ce.png, /upload/2022/02/image-3605ccc5f5bd43e19468184e970b44ce.png 1.5x, /upload/2022/02/image-3605ccc5f5bd43e19468184e970b44ce.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-3605ccc5f5bd43e19468184e970b44ce.png"
        title="image" /></p>
<p>是sp指针出了问题，可以通过Options-&gt;General-&gt;Disassembly右边勾上stack pointer</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-c11d5bc013674698956d2f9906ba71cc.png"
        data-srcset="/upload/2022/02/image-c11d5bc013674698956d2f9906ba71cc.png, /upload/2022/02/image-c11d5bc013674698956d2f9906ba71cc.png 1.5x, /upload/2022/02/image-c11d5bc013674698956d2f9906ba71cc.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-c11d5bc013674698956d2f9906ba71cc.png"
        title="image" /></p>
<p>可以明显看到loc_400BBF函数中的sp指针值出了问题</p>
<p>这样看来，这个函数就是为了扰乱sp存在的，直接从BB7到BD0全patch掉</p>
<p>同理CB5到CCE也全patch掉</p>
<p>但这时ida把main函数断在了CB9这一行</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-ac520d37bc394e43bc551c30d7599dab.png"
        data-srcset="/upload/2022/02/image-ac520d37bc394e43bc551c30d7599dab.png, /upload/2022/02/image-ac520d37bc394e43bc551c30d7599dab.png 1.5x, /upload/2022/02/image-ac520d37bc394e43bc551c30d7599dab.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-ac520d37bc394e43bc551c30d7599dab.png"
        title="image" /></p>
<p>可以回到main函数开始按u取消定义，然后按c重新转换为code</p>
<p>然后终于可以快乐地F5了,main函数真容：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="kr">__fastcall</span> <span class="n">__noreturn</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a2</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+4h] [rbp-23Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">input</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span> <span class="c1">// [rsp+10h] [rbp-230h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v5</span><span class="p">[</span><span class="mi">520</span><span class="p">];</span> <span class="c1">// [rsp+30h] [rbp-210h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [rsp+238h] [rbp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span> <span class="o">=</span> <span class="nf">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">memset</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">512uLL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">input</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">input</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">input</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="nf">sub_4008B9</span><span class="p">((</span><span class="kr">__int64</span><span class="p">)</span><span class="n">v5</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="mi">0LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">read</span><span class="p">(</span><span class="mi">0LL</span><span class="p">,</span> <span class="n">input</span><span class="p">,</span> <span class="mi">19LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">qword_602048</span> <span class="o">=</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="n">sub_400A69</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mprotect</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">main</span> <span class="o">&amp;</span> <span class="mh">0xFFFFC000</span><span class="p">,</span> <span class="mh">0x10uLL</span><span class="p">,</span> <span class="mi">7uLL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">qword_602048</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">^=</span> <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">input</span> <span class="o">+</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="nf">sub_400A69</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">v5</span><span class="p">,</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="n">input</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int16</span><span class="p">)</span><span class="n">v5</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">write</span><span class="p">(</span><span class="mi">1LL</span><span class="p">,</span> <span class="s">&#34;Cong!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">6LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">exit</span><span class="p">(</span><span class="mi">0LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>17行创建了一个sub_400A69函数段的指针</p>
<p>18行<a href="https://blog.csdn.net/roland_sun/article/details/33728955" target="_blank" rel="noopener noreffer ">mprotect函数</a>将sub_400A69段代码的权限改为7（即rwx）</p>
<p>然后20行修改了sub_400A69的代码，与input前5位（n1ctf）异或，即SMC，先写个脚本还原一下正确的代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">ida_bytes</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;n1ctf&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="nf">patch_byte</span><span class="p">(</span><span class="mh">0x400A69</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="nf">get_byte</span><span class="p">(</span><span class="mh">0x400A69</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">^</span><span class="nf">ord</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="mi">5</span><span class="p">]))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>还原之后F5还是失败，原因是有和main函数一样的花指令和扰乱sp的代码，一样处理后得到函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">sub_400A69</span><span class="p">(</span><span class="kr">__int64</span> <span class="n">a1</span><span class="p">,</span> <span class="kr">__int64</span> <span class="n">a2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">__int64</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// rbp
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+14h] [rbp-2Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v5</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span> <span class="c1">// [rsp+18h] [rbp-28h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [rsp+30h] [rbp-10h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [rsp+38h] [rbp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span> <span class="o">=</span> <span class="n">v2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span> <span class="o">=</span> <span class="nf">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">53</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">45</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">26</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">73</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">125</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">qmemcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v5</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="s">&#34;+;&gt;=&lt;_&#34;</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">13</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="n">v5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="p">((</span><span class="o">*</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)(</span><span class="n">i</span> <span class="o">+</span> <span class="n">a1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">^</span> <span class="o">*</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)(</span><span class="n">i</span> <span class="o">+</span> <span class="n">a2</span><span class="p">))</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">1LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>重新进main函数看一下传进来的参数，这里需要再按一下F5，让ida根据修复后的代码重新分析一下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="kr">__fastcall</span> <span class="n">__noreturn</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a2</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+4h] [rbp-23Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">input</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span> <span class="c1">// [rsp+10h] [rbp-230h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v5</span><span class="p">[</span><span class="mi">520</span><span class="p">];</span> <span class="c1">// [rsp+30h] [rbp-210h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [rsp+238h] [rbp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span> <span class="o">=</span> <span class="nf">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">memset</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x200uLL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">input</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">input</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">input</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="nf">sub_4008B9</span><span class="p">((</span><span class="kr">__int64</span><span class="p">)</span><span class="n">v5</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="mi">0LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">read</span><span class="p">(</span><span class="mi">0LL</span><span class="p">,</span> <span class="n">input</span><span class="p">,</span> <span class="mi">19LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">qword_602048</span> <span class="o">=</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="n">sub_400A69</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mprotect</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">main</span> <span class="o">&amp;</span> <span class="mh">0xFFFFC000</span><span class="p">,</span> <span class="mi">16LL</span><span class="p">,</span> <span class="mi">7LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">qword_602048</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">^=</span> <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">input</span> <span class="o">+</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="nf">sub_400A69</span><span class="p">((</span><span class="kr">__int64</span><span class="p">)</span><span class="n">v5</span><span class="p">,</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="n">input</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">write</span><span class="p">(</span><span class="mi">1LL</span><span class="p">,</span> <span class="s">&#34;Cong!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">6LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">exit</span><span class="p">(</span><span class="mi">0LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在只需求出main函数里的v5即sub_400A69里的a1，即可解出flag</p>
<p>sub_4008B9里面实现太复杂了，想法是动调得到v5，但这里面有ptrace反调试</p>
<p>又因为反调试在输入之前，所以可以先运行到输出，然后再attach上去</p>
<p>这里我做的时候只有root用户运行可以，普通用户会报错权限不足什么的，具体原因不清楚</p>
<p>attach上之后main函数点进去v5，可以看到需要的前14位就是<code>Linux Version </code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-f45983ae22e14c029ce450a61d2965dc.png"
        data-srcset="/upload/2022/02/image-f45983ae22e14c029ce450a61d2965dc.png, /upload/2022/02/image-f45983ae22e14c029ce450a61d2965dc.png 1.5x, /upload/2022/02/image-f45983ae22e14c029ce450a61d2965dc.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-f45983ae22e14c029ce450a61d2965dc.png"
        title="image" /></p>
<p>最后写脚本解flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">char</span> <span class="n">en_flag</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="mi">53</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">73</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="sc">&#39;+&#39;</span><span class="p">,</span><span class="sc">&#39;;&#39;</span><span class="p">,</span><span class="sc">&#39;&gt;&#39;</span><span class="p">,</span><span class="sc">&#39;=&#39;</span><span class="p">,</span><span class="sc">&#39;&lt;&#39;</span><span class="p">,</span><span class="sc">&#39;_&#39;</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span> <span class="n">v5</span><span class="p">[]</span><span class="o">=</span><span class="s">&#34;Linux Version &#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span> <span class="n">flag</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">13</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">v5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">^</span><span class="n">en_flag</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="n">flag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// {Fam3_Is_NULL}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="0x02-xnuca-2020-unravel-mfc">0x02 XNUCA 2020 Unravel MFC</h2>
<p>没有最难，只有更难，这周已经做得心态爆炸了（（</p>
<p>开始连有用的函数都找不到，官方wp写得也有亿点简略，搞了几个小时也进展不大</p>
<p>先放放吧，后面再填坑</p>
<h1 id="第七周">第七周</h1>
<h3 id="000-guetctf-2019-number-game">0×00 GUETCTF 2019 number game</h3>
<p>拒 绝 暴 力</p>
<p>die查，Elf64，进ida</p>
<p>main函数东西有点多，一个一个看</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a2</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">_QWORD</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+8h] [rbp-38h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [rsp+10h] [rbp-30h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int16</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-28h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-20h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int16</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-18h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// [rsp+2Ah] [rbp-16h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// [rsp+38h] [rbp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v10</span> <span class="o">=</span> <span class="nf">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v9</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">__isoc99_scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="nf">sub_4006D6</span><span class="p">((</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v5</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v4</span> <span class="o">=</span> <span class="nf">sub_400758</span><span class="p">((</span><span class="kr">__int64</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sub_400807</span><span class="p">((</span><span class="kr">__int64</span><span class="p">)</span><span class="n">v4</span><span class="p">,</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v7</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">v9</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sub_400881</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v7</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="nf">sub_400917</span><span class="p">()</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;TQL!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;flag{&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;}&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;your are cxk!!&#34;</span><span class="p">);</span>     <span class="c1">//cai xu kun???
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nf">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">)</span> <span class="o">^</span> <span class="n">v10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>sub_4006D6（）判断输入是否为数字0-4，且共10位</p>
<p>剩下几个函数可以倒着看</p>
<p>第二个if里面sub_4006D6（）的判断是一个5*5的数独逻辑</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">1 4 # 2 3
</span></span><span class="line"><span class="cl">3 0 # 1 #
</span></span><span class="line"><span class="cl">0 # 2 3 #
</span></span><span class="line"><span class="cl"># 3 # # 0
</span></span><span class="line"><span class="cl">4 2 # # 1
</span></span></code></pre></td></tr></table>
</div>
</div><p>手动填一下是0421421430</p>
<p>sub_400881(&amp;v7)就是用上面的值填数独待检验</p>
<p>sub_400807（）应该只是复制了一下，v4-&gt;v7，动调验证确实啥也没干</p>
<p>主要加密函数是sub_400758（）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">_QWORD</span> <span class="o">*</span><span class="kr">__fastcall</span> <span class="nf">sub_400758</span><span class="p">(</span><span class="kr">__int64</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a2</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [rsp+1Fh] [rbp-11h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">_QWORD</span> <span class="o">*</span><span class="n">v6</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="n">a1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">v5</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span> <span class="o">||</span> <span class="n">v5</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span> <span class="o">||</span> <span class="n">a2</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">a3</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span> <span class="o">=</span> <span class="nf">malloc</span><span class="p">(</span><span class="mi">24uLL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">v6</span> <span class="o">=</span> <span class="n">v5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nf">sub_400758</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nf">sub_400758</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">a3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">v6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>递归，<code>2 * a2 + 1</code>，<code>2 * (a2 + 1)</code>，第一感觉是二叉树访问左右子树，没点OI基础都做不了逆向（（</p>
<p>动调验证一下，实际是通过对input按数组下标建立二叉树，然后输出中序遍历</p>
<p>于是可以根据0421421430手动建树，这里因为默认二叉树从左到右生长，所以保证了答案的唯一性</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl">       <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span>     <span class="mi">3</span>
</span></span><span class="line"><span class="cl">  <span class="mi">4</span>   <span class="mi">2</span>  <span class="mi">4</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mi">2</span>  <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="c1">//flag：1134240024
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="0x01-hitctf-2020-node">0x01 HITCTF 2020 Node</h2>
<p>没想法，没思路，verify函数上千行代码劝退（（</p>
<p>只能拜读RX的wp</p>
<p>原来只要找到345行一逆就行<code>while ( (char)(*((_BYTE *)v124 + v37) ^ 'r') + 'h' == key[v37] )</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">key</span><span class="p">[]</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">,</span> <span class="mh">0xC7</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0xBA</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">  <span class="mh">0x6D</span><span class="p">,</span> <span class="mh">0x7B</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x6E</span><span class="p">,</span> <span class="mh">0xBA</span><span class="p">,</span> <span class="mh">0x7B</span><span class="p">,</span> <span class="mh">0xBA</span><span class="p">,</span> <span class="mh">0x7D</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">  <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x7C</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x7F</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x7E</span><span class="p">,</span> <span class="mh">0xC6</span><span class="p">,</span> <span class="mh">0x6D</span><span class="p">,</span> <span class="mh">0x6F</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">  <span class="mh">0x6D</span><span class="p">,</span> <span class="mh">0x6F</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span> <span class="n">flag</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">32</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="sc">&#39;h&#39;</span><span class="p">)</span><span class="o">^</span><span class="sc">&#39;r&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="n">flag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//Yoshino-s want a girlfriend,wuwu
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>难点在于根本找不到</p>
<p>根据bb的wp获得思路，既然逆出来的东西要用来做web，那么一定在export窗口能找到</p>
<p>打开export窗口很显眼地就能看到<code>key</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-ac16fef115c64503989ed335fa1603c8.png"
        data-srcset="/upload/2022/02/image-ac16fef115c64503989ed335fa1603c8.png, /upload/2022/02/image-ac16fef115c64503989ed335fa1603c8.png 1.5x, /upload/2022/02/image-ac16fef115c64503989ed335fa1603c8.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-ac16fef115c64503989ed335fa1603c8.png"
        title="image" /></p>
<p>查交叉引用就能找到verify函数，就能定位345行，问题解决，又长见识了</p>
<h3 id="002-gkctf-2020-babydriver">0×02 GKCTF 2020 BabyDriver</h3>
<p>die查，PE64，进ida</p>
<p>翻string窗口看到了</p>
<p><code>.data:0000000140003000    000000E1    C    ****************o.*..*......*..**.**...**.*.*.***.****.**.*.*.***.......*.*.*****..***..*..**..***....**....**....***..**.***.***....**...***.**********..***......#****.*****************************</code></p>
<p>打开果然是个地图，共225byte</p>
<p>刚开始还以为是<code>15*5</code>，后面看代码觉得不对，最后确定是<code>14*16</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="o">****************</span>
</span></span><span class="line"><span class="cl"><span class="n">o</span><span class="p">.</span><span class="o">*</span><span class="p">..</span><span class="o">*</span><span class="p">......</span><span class="o">*</span><span class="p">..</span><span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="p">.</span><span class="o">**</span><span class="p">...</span><span class="o">**</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="o">**</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="p">.</span><span class="o">****</span><span class="p">.</span><span class="o">**</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="o">**</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="p">...</span><span class="o">**</span><span class="p">....</span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="o">**</span>
</span></span><span class="line"><span class="cl"><span class="o">***</span><span class="p">..</span><span class="o">***</span><span class="p">.</span><span class="o">**</span><span class="p">.</span><span class="o">*</span><span class="p">..</span><span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="p">.</span><span class="o">**</span><span class="p">.</span><span class="o">***</span><span class="p">.</span><span class="o">**</span><span class="p">.</span><span class="o">**</span><span class="p">.</span><span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="p">.</span><span class="o">**</span><span class="p">.</span><span class="o">******</span><span class="p">.</span><span class="o">**</span><span class="p">.</span><span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="p">.</span><span class="o">**</span><span class="p">....</span><span class="o">***</span><span class="p">.</span><span class="o">**</span><span class="p">.</span><span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="p">.</span><span class="o">*****</span><span class="p">.</span><span class="o">***</span><span class="p">....</span><span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="p">...</span><span class="o">***</span><span class="p">.</span><span class="o">********</span>
</span></span><span class="line"><span class="cl"><span class="o">**</span><span class="p">..</span><span class="o">***</span><span class="p">......</span><span class="err">#</span><span class="o">**</span>
</span></span><span class="line"><span class="cl"><span class="o">**</span><span class="p">.</span><span class="o">*************</span>
</span></span><span class="line"><span class="cl"><span class="o">****************</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>根据地图查交叉引用定位走地图逻辑函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">sub_140001380</span><span class="p">(</span><span class="kr">__int64</span> <span class="n">a1</span><span class="p">,</span> <span class="kr">__int64</span> <span class="n">a2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">__int64</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// rdi
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// rax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// ecx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int16</span> <span class="o">*</span><span class="n">v6</span><span class="p">;</span> <span class="c1">// rsi
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// rbp
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int16</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// dx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// dl
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">const</span> <span class="n">CHAR</span> <span class="o">*</span><span class="n">v10</span><span class="p">;</span> <span class="c1">// rcx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">48</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v3</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">24</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">v4</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">56</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">_DWORD</span><span class="p">)</span><span class="n">v4</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">v5</span> <span class="o">=</span> <span class="n">dword_1400030E4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">v6</span> <span class="o">=</span> <span class="p">(</span><span class="kr">__int16</span> <span class="o">*</span><span class="p">)(</span><span class="n">v3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">v7</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">v4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">while</span> <span class="p">(</span> <span class="o">*</span><span class="p">(</span><span class="n">_WORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">v3</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nl">LABEL_28</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">v6</span> <span class="o">+=</span> <span class="mi">6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="o">!--</span><span class="n">v7</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="k">goto</span> <span class="n">LABEL_29</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="n">byte_140003000</span><span class="p">[</span><span class="n">v5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">46</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">v8</span> <span class="o">=</span> <span class="o">*</span><span class="n">v6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="n">v6</span> <span class="o">==</span> <span class="mh">0x17</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">v5</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFF0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">v5</span> <span class="o">-=</span> <span class="mi">16</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">goto</span> <span class="n">LABEL_21</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">v5</span> <span class="o">+=</span> <span class="mi">208</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">dword_1400030E4</span> <span class="o">=</span> <span class="n">v5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="n">v8</span> <span class="o">==</span> <span class="mh">0x25</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">v5</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFF0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">208</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">v5</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">goto</span> <span class="n">LABEL_21</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">v5</span> <span class="o">-=</span> <span class="mi">208</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">dword_1400030E4</span> <span class="o">=</span> <span class="n">v5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="n">v8</span> <span class="o">==</span> <span class="mh">0x24</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">v5</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="o">--</span><span class="n">v5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">goto</span> <span class="n">LABEL_21</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">v5</span> <span class="o">+=</span> <span class="mi">15</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">dword_1400030E4</span> <span class="o">=</span> <span class="n">v5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="n">v8</span> <span class="o">!=</span> <span class="mh">0x26</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">goto</span> <span class="n">LABEL_22</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">v5</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">)</span> <span class="o">==</span> <span class="mi">15</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">v5</span> <span class="o">-=</span> <span class="mi">15</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="o">++</span><span class="n">v5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nl">LABEL_21</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">dword_1400030E4</span> <span class="o">=</span> <span class="n">v5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nl">LABEL_22</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">v9</span> <span class="o">=</span> <span class="n">byte_140003000</span><span class="p">[</span><span class="n">v5</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="n">v9</span> <span class="o">==</span> <span class="mi">42</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">v10</span> <span class="o">=</span> <span class="s">&#34;failed!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="n">v9</span> <span class="o">!=</span> <span class="mi">35</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nl">LABEL_27</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">          <span class="n">byte_140003000</span><span class="p">[</span><span class="n">v5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">111</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">goto</span> <span class="n">LABEL_28</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">v10</span> <span class="o">=</span> <span class="s">&#34;success! flag is flag{md5(input)}</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="n">dword_1400030E4</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nf">DbgPrint</span><span class="p">(</span><span class="n">v10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">v5</span> <span class="o">=</span> <span class="n">dword_1400030E4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">goto</span> <span class="n">LABEL_27</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nl">LABEL_29</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">65</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">184</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="n">i64</span><span class="p">)</span> <span class="o">|=</span> <span class="mi">1u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">48</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>上下左右逻辑容易看出来，但值0x17,0x25什么的太奇怪了</p>
<p>偷看师傅们的wp知道了原来是键盘扫描码，<a href="https://codetd.com/en/article/13337857" target="_blank" rel="noopener noreffer ">粘个链接</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="mh">0x17</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="n">up</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mh">0x24</span><span class="o">-</span><span class="n">j</span><span class="o">-</span><span class="n">left</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mh">0x25</span><span class="o">-</span><span class="n">k</span><span class="o">-</span><span class="n">down</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mh">0x26</span><span class="o">-</span><span class="n">l</span><span class="o">-</span><span class="n">right</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>手动走一下：lkkkllklkkklllkkklllll</p>
<p>结果不对？？好吧得全大写再求md5</p>
<p>最终flag：flag{403950a6f64f7fc4b655dea696997851}</p>
<h1 id="第六周">第六周</h1>
<h3 id="000-pydis">0×00 PyDis</h3>
<p>附件是pyc，先想到uncompyle6</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">DX3906</span><span class="err">\</span><span class="n">Desktop</span><span class="err">\</span><span class="n">t1</span><span class="o">&gt;</span><span class="n">uncompyle6</span> <span class="n">pyre</span><span class="p">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">39.</span><span class="n">pyc</span><span class="o">&gt;</span><span class="mf">2.</span><span class="n">py</span>
</span></span><span class="line"><span class="cl"><span class="cp"># Unsupported bytecode in file pyre.cpython-39.pyc
</span></span></span><span class="line"><span class="cl"><span class="cp"># Unsupported Python version, 3.9.0, for decompilation
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>3.9不支持，痛苦开始</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">dis</span><span class="o">,</span><span class="nn">marshal</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&#34;pyre.cpython-39.pyc&#34;</span><span class="p">,</span><span class="s2">&#34;rb&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">code</span> <span class="o">=</span> <span class="n">marshal</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">16</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl"><span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>先抄含树师傅的代码得字节码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl">  <span class="mi">1</span>           <span class="mi">0</span> <span class="n">BUILD_LIST</span>               <span class="mi">0</span>
</span></span><span class="line"><span class="cl">              <span class="mi">2</span> <span class="n">LOAD_CONST</span>               <span class="mi">0</span> <span class="p">((</span><span class="mi">178</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">167</span><span class="p">,</span> <span class="mi">163</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">              <span class="mi">4</span> <span class="n">LIST_EXTEND</span>              <span class="mi">1</span>
</span></span><span class="line"><span class="cl">              <span class="mi">6</span> <span class="n">STORE_NAME</span>               <span class="mi">0</span> <span class="p">(</span><span class="n">magic</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="mi">2</span>           <span class="mi">8</span> <span class="n">LOAD_NAME</span>                <span class="mi">1</span> <span class="p">(</span><span class="n">input</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">10</span> <span class="n">LOAD_CONST</span>               <span class="mi">1</span> <span class="p">(</span><span class="err">&#39;</span><span class="n">flag</span> <span class="o">&gt;&gt;&gt;</span> <span class="err">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">12</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
</span></span><span class="line"><span class="cl">             <span class="mi">14</span> <span class="n">STORE_NAME</span>               <span class="mi">2</span> <span class="p">(</span><span class="n">inp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="mi">4</span>          <span class="mi">16</span> <span class="n">LOAD_NAME</span>                <span class="mi">3</span> <span class="p">(</span><span class="n">list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">18</span> <span class="n">LOAD_NAME</span>                <span class="mi">2</span> <span class="p">(</span><span class="n">inp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">20</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
</span></span><span class="line"><span class="cl">             <span class="mi">22</span> <span class="n">STORE_NAME</span>               <span class="mi">4</span> <span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="mi">5</span>          <span class="mi">24</span> <span class="n">LOAD_NAME</span>                <span class="mi">5</span> <span class="p">(</span><span class="n">len</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">26</span> <span class="n">LOAD_NAME</span>                <span class="mi">4</span> <span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">28</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
</span></span><span class="line"><span class="cl">             <span class="mi">30</span> <span class="n">LOAD_NAME</span>                <span class="mi">5</span> <span class="p">(</span><span class="n">len</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">32</span> <span class="n">LOAD_NAME</span>                <span class="mi">0</span> <span class="p">(</span><span class="n">magic</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">34</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
</span></span><span class="line"><span class="cl">             <span class="mi">36</span> <span class="n">COMPARE_OP</span>               <span class="mi">3</span> <span class="p">(</span><span class="o">!=</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">38</span> <span class="n">POP_JUMP_IF_FALSE</span>       <span class="mi">54</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="mi">6</span>          <span class="mi">40</span> <span class="n">LOAD_NAME</span>                <span class="mi">6</span> <span class="p">(</span><span class="n">print</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">42</span> <span class="n">LOAD_CONST</span>               <span class="mi">2</span> <span class="p">(</span><span class="err">&#39;</span><span class="n">qwq</span><span class="err">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">44</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
</span></span><span class="line"><span class="cl">             <span class="mi">46</span> <span class="n">POP_TOP</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="mi">7</span>          <span class="mi">48</span> <span class="n">LOAD_NAME</span>                <span class="mi">7</span> <span class="p">(</span><span class="n">exit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">50</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">0</span>
</span></span><span class="line"><span class="cl">             <span class="mi">52</span> <span class="n">POP_TOP</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="mi">9</span>     <span class="o">&gt;&gt;</span>   <span class="mi">54</span> <span class="n">LOAD_NAME</span>                <span class="mi">8</span> <span class="p">(</span><span class="n">range</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">56</span> <span class="n">LOAD_NAME</span>                <span class="mi">5</span> <span class="p">(</span><span class="n">len</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">58</span> <span class="n">LOAD_NAME</span>                <span class="mi">4</span> <span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">60</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
</span></span><span class="line"><span class="cl">             <span class="mi">62</span> <span class="n">LOAD_CONST</span>               <span class="mi">3</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">64</span> <span class="n">BINARY_FLOOR_DIVIDE</span>
</span></span><span class="line"><span class="cl">             <span class="mi">66</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
</span></span><span class="line"><span class="cl">             <span class="mi">68</span> <span class="n">GET_ITER</span>
</span></span><span class="line"><span class="cl">        <span class="o">&gt;&gt;</span>   <span class="mi">70</span> <span class="n">FOR_ITER</span>                <span class="mi">54</span> <span class="p">(</span><span class="n">to</span> <span class="mi">126</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">72</span> <span class="n">STORE_NAME</span>               <span class="mi">9</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="mi">10</span>          <span class="mi">74</span> <span class="n">LOAD_NAME</span>                <span class="mi">4</span> <span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">76</span> <span class="n">LOAD_CONST</span>               <span class="mi">3</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">78</span> <span class="n">LOAD_NAME</span>                <span class="mi">9</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">80</span> <span class="n">BINARY_MULTIPLY</span>
</span></span><span class="line"><span class="cl">             <span class="mi">82</span> <span class="n">LOAD_CONST</span>               <span class="mi">4</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">84</span> <span class="n">BINARY_ADD</span>
</span></span><span class="line"><span class="cl">             <span class="mi">86</span> <span class="n">BINARY_SUBSCR</span>
</span></span><span class="line"><span class="cl">             <span class="mi">88</span> <span class="n">LOAD_NAME</span>                <span class="mi">4</span> <span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">90</span> <span class="n">LOAD_CONST</span>               <span class="mi">3</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">92</span> <span class="n">LOAD_NAME</span>                <span class="mi">9</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="mi">94</span> <span class="n">BINARY_MULTIPLY</span>
</span></span><span class="line"><span class="cl">             <span class="mi">96</span> <span class="n">BINARY_SUBSCR</span>
</span></span><span class="line"><span class="cl">             <span class="mi">98</span> <span class="n">ROT_TWO</span>
</span></span><span class="line"><span class="cl">            <span class="mi">100</span> <span class="n">LOAD_NAME</span>                <span class="mi">4</span> <span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">102</span> <span class="n">LOAD_CONST</span>               <span class="mi">3</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">104</span> <span class="n">LOAD_NAME</span>                <span class="mi">9</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">106</span> <span class="n">BINARY_MULTIPLY</span>
</span></span><span class="line"><span class="cl">            <span class="mi">108</span> <span class="n">STORE_SUBSCR</span>
</span></span><span class="line"><span class="cl">            <span class="mi">110</span> <span class="n">LOAD_NAME</span>                <span class="mi">4</span> <span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">112</span> <span class="n">LOAD_CONST</span>               <span class="mi">3</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">114</span> <span class="n">LOAD_NAME</span>                <span class="mi">9</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">116</span> <span class="n">BINARY_MULTIPLY</span>
</span></span><span class="line"><span class="cl">            <span class="mi">118</span> <span class="n">LOAD_CONST</span>               <span class="mi">4</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">120</span> <span class="n">BINARY_ADD</span>
</span></span><span class="line"><span class="cl">            <span class="mi">122</span> <span class="n">STORE_SUBSCR</span>
</span></span><span class="line"><span class="cl">            <span class="mi">124</span> <span class="n">JUMP_ABSOLUTE</span>           <span class="mi">70</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="mi">12</span>     <span class="o">&gt;&gt;</span>  <span class="mi">126</span> <span class="n">BUILD_LIST</span>               <span class="mi">0</span>
</span></span><span class="line"><span class="cl">            <span class="mi">128</span> <span class="n">STORE_NAME</span>              <span class="mi">10</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="mi">14</span>         <span class="mi">130</span> <span class="n">LOAD_NAME</span>                <span class="mi">8</span> <span class="p">(</span><span class="n">range</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">132</span> <span class="n">LOAD_NAME</span>                <span class="mi">5</span> <span class="p">(</span><span class="n">len</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">134</span> <span class="n">LOAD_NAME</span>                <span class="mi">4</span> <span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">136</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="mi">138</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="mi">140</span> <span class="n">GET_ITER</span>
</span></span><span class="line"><span class="cl">        <span class="o">&gt;&gt;</span>  <span class="mi">142</span> <span class="n">FOR_ITER</span>                <span class="mi">26</span> <span class="p">(</span><span class="n">to</span> <span class="mi">170</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">144</span> <span class="n">STORE_NAME</span>               <span class="mi">9</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="mi">15</span>         <span class="mi">146</span> <span class="n">LOAD_NAME</span>               <span class="mi">10</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">148</span> <span class="n">LOAD_METHOD</span>             <span class="mi">11</span> <span class="p">(</span><span class="n">append</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">150</span> <span class="n">LOAD_NAME</span>               <span class="mi">12</span> <span class="p">(</span><span class="n">ord</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">152</span> <span class="n">LOAD_NAME</span>                <span class="mi">4</span> <span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">154</span> <span class="n">LOAD_NAME</span>                <span class="mi">9</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">156</span> <span class="n">BINARY_SUBSCR</span>
</span></span><span class="line"><span class="cl">            <span class="mi">158</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="mi">160</span> <span class="n">LOAD_CONST</span>               <span class="mi">5</span> <span class="p">(</span><span class="mi">222</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">162</span> <span class="n">BINARY_XOR</span>
</span></span><span class="line"><span class="cl">            <span class="mi">164</span> <span class="n">CALL_METHOD</span>              <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="mi">166</span> <span class="n">POP_TOP</span>
</span></span><span class="line"><span class="cl">            <span class="mi">168</span> <span class="n">JUMP_ABSOLUTE</span>          <span class="mi">142</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="mi">17</span>     <span class="o">&gt;&gt;</span>  <span class="mi">170</span> <span class="n">LOAD_NAME</span>                <span class="mi">8</span> <span class="p">(</span><span class="n">range</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">172</span> <span class="n">LOAD_NAME</span>                <span class="mi">5</span> <span class="p">(</span><span class="n">len</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">174</span> <span class="n">LOAD_NAME</span>                <span class="mi">0</span> <span class="p">(</span><span class="n">magic</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">176</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="mi">178</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="mi">180</span> <span class="n">GET_ITER</span>
</span></span><span class="line"><span class="cl">        <span class="o">&gt;&gt;</span>  <span class="mi">182</span> <span class="n">FOR_ITER</span>                <span class="mi">34</span> <span class="p">(</span><span class="n">to</span> <span class="mi">218</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">184</span> <span class="n">STORE_NAME</span>               <span class="mi">9</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="mi">18</span>         <span class="mi">186</span> <span class="n">LOAD_NAME</span>               <span class="mi">10</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">188</span> <span class="n">LOAD_NAME</span>                <span class="mi">9</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">190</span> <span class="n">BINARY_SUBSCR</span>
</span></span><span class="line"><span class="cl">            <span class="mi">192</span> <span class="n">LOAD_NAME</span>                <span class="mi">0</span> <span class="p">(</span><span class="n">magic</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">194</span> <span class="n">LOAD_NAME</span>                <span class="mi">9</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">196</span> <span class="n">BINARY_SUBSCR</span>
</span></span><span class="line"><span class="cl">            <span class="mi">198</span> <span class="n">COMPARE_OP</span>               <span class="mi">3</span> <span class="p">(</span><span class="o">!=</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">200</span> <span class="n">POP_JUMP_IF_FALSE</span>      <span class="mi">182</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="mi">19</span>         <span class="mi">202</span> <span class="n">LOAD_NAME</span>                <span class="mi">6</span> <span class="p">(</span><span class="n">print</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">204</span> <span class="n">LOAD_CONST</span>               <span class="mi">2</span> <span class="p">(</span><span class="err">&#39;</span><span class="n">qwq</span><span class="err">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">206</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="mi">208</span> <span class="n">POP_TOP</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="mi">20</span>         <span class="mi">210</span> <span class="n">LOAD_NAME</span>                <span class="mi">7</span> <span class="p">(</span><span class="n">exit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">212</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">0</span>
</span></span><span class="line"><span class="cl">            <span class="mi">214</span> <span class="n">POP_TOP</span>
</span></span><span class="line"><span class="cl">            <span class="mi">216</span> <span class="n">JUMP_ABSOLUTE</span>          <span class="mi">182</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="mi">22</span>     <span class="o">&gt;&gt;</span>  <span class="mi">218</span> <span class="n">LOAD_NAME</span>                <span class="mi">6</span> <span class="p">(</span><span class="n">print</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">220</span> <span class="n">LOAD_CONST</span>               <span class="mi">6</span> <span class="p">(</span><span class="err">&#39;</span><span class="n">happy</span> <span class="n">new</span> <span class="n">year</span><span class="o">!</span><span class="err">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">222</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="mi">224</span> <span class="n">POP_TOP</span>
</span></span><span class="line"><span class="cl">            <span class="mi">226</span> <span class="n">LOAD_CONST</span>               <span class="mi">7</span> <span class="p">(</span><span class="n">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">228</span> <span class="n">RETURN_VALUE</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>参考：<a href="https://www.cnblogs.com/yinguohai/p/11158492.html" target="_blank" rel="noopener noreffer ">死磕字节码        </a><a href="https://docs.python.org/3.7/library/dis.html" target="_blank" rel="noopener noreffer ">python官方文档</a> 分析逻辑</p>
<p>大概是这个意思（还是习惯写c</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span> <span class="n">magic</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="mi">178</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">167</span><span class="p">,</span> <span class="mi">163</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span> <span class="n">flag</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span><span class="n">flag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="kt">char</span> <span class="n">x</span><span class="o">=</span><span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">17</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">^=</span><span class="mi">222</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">!=</span><span class="n">magic</span><span class="p">[</span><span class="n">i</span><span class="p">]){</span>
</span></span><span class="line"><span class="cl">            <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;wrong&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;write&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>写脚本解密</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">char</span> <span class="n">en_flag</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="mi">178</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">167</span><span class="p">,</span> <span class="mi">163</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">17</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">en_flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">^=</span><span class="mi">222</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="kt">char</span> <span class="n">x</span><span class="o">=</span><span class="n">en_flag</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="n">en_flag</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">en_flag</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="n">en_flag</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="n">en_flag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//flag{hapi_new_ya}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="001-flareon4-igniteme">0×01 FlareOn4 IgniteMe</h2>
<p>die查，无壳，PE32，进ida</p>
<p>主函数长这样</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">__noreturn</span> <span class="nf">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">DWORD</span> <span class="n">NumberOfBytesWritten</span><span class="p">;</span> <span class="c1">// [esp+0h] [ebp-4h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">NumberOfBytesWritten</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">hFile</span> <span class="o">=</span> <span class="nf">GetStdHandle</span><span class="p">(</span><span class="mh">0xFFFFFFF6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">dword_403074</span> <span class="o">=</span> <span class="nf">GetStdHandle</span><span class="p">(</span><span class="mh">0xFFFFFFF5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">WriteFile</span><span class="p">(</span><span class="n">dword_403074</span><span class="p">,</span> <span class="n">aG1v3M3T3hFl4g</span><span class="p">,</span> <span class="mh">0x13u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">NumberOfBytesWritten</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">sub_4010F0</span><span class="p">(</span><span class="n">NumberOfBytesWritten</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="nf">sub_401050</span><span class="p">()</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">WriteFile</span><span class="p">(</span><span class="n">dword_403074</span><span class="p">,</span> <span class="n">aG00dJ0b</span><span class="p">,</span> <span class="mh">0xAu</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">NumberOfBytesWritten</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="nf">WriteFile</span><span class="p">(</span><span class="n">dword_403074</span><span class="p">,</span> <span class="n">aN0tT00H0tRWe7r</span><span class="p">,</span> <span class="mh">0x24u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">NumberOfBytesWritten</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ExitProcess</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>sub_4010F0()这个函数好像什么也没干</p>
<p>主要加密在sub_401050()</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">sub_401050</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// [esp+0h] [ebp-Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [esp+4h] [ebp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span><span class="p">;</span> <span class="c1">// [esp+4h] [ebp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [esp+Bh] [ebp-1h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v1</span> <span class="o">=</span> <span class="nf">sub_401020</span><span class="p">(</span><span class="n">byte_403078</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v4</span> <span class="o">=</span> <span class="nf">sub_401000</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">byte_403180</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v4</span> <span class="o">^</span> <span class="n">byte_403078</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">v4</span> <span class="o">=</span> <span class="n">byte_403078</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mh">0x27</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="n">byte_403180</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">byte_403000</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>看一下里面代码能猜出来sub_401020()就是strlen()</p>
<p>v4直接动调就是0x4</p>
<p>写脚本解密</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">char</span> <span class="n">en_flag</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="mi">13</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span><span class="mi">73</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span><span class="mi">93</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span><span class="mi">86</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span> <span class="n">flag</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">V4</span><span class="o">=</span><span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">39</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">en_flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">^</span><span class="n">V4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">V4</span><span class="o">=</span><span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="n">flag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//flag;{R_y0u_H0t_3n0ugH_t0_1gn1t3@flare-on.com}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="0x02-buuctf-firmware">0x02 BUUCTF Firmware</h2>
<p>这题难点在于工具的安装（（</p>
<p>跟着含树师傅的wp走</p>
<p>windows比较麻烦，直接开虚拟机先装binwalk,觉得慢可以换个源</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">git</span> <span class="n">clone</span> <span class="nl">https</span><span class="p">:</span><span class="c1">//github.com/devttys0/binwalk
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">cd</span> <span class="n">binwalk</span>
</span></span><span class="line"><span class="cl"><span class="n">python</span> <span class="n">setup</span><span class="p">.</span><span class="n">py</span> <span class="n">install</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>先binwalk -e 拆包，四个文件，挨个file命令查看</p>
<p>有用的就是120200.squashfs，这里要用 firmware-mod-kit 的 unsquashfs_all.sh工具</p>
<p>然后就遇到了和bb师傅一样的问题，持续痛苦面具</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-57a26128130d401b8d5ff64e83169a96.png"
        data-srcset="/upload/2022/02/image-57a26128130d401b8d5ff64e83169a96.png, /upload/2022/02/image-57a26128130d401b8d5ff64e83169a96.png 1.5x, /upload/2022/02/image-57a26128130d401b8d5ff64e83169a96.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-57a26128130d401b8d5ff64e83169a96.png"
        title="image" /></p>
<p>幸好RX神是万能的</p>
<p>发现问题是github仓库的源代码有问题</p>
<p>换一个仓库一切正常了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">git</span> <span class="n">clone</span> <span class="nl">https</span><span class="p">:</span><span class="c1">//github.com/rampageX/firmware-mod-kit.git
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">cd</span> <span class="n">firmware</span><span class="o">-</span><span class="n">mod</span><span class="o">-</span><span class="n">kit</span><span class="o">/</span><span class="n">src</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="o">/</span><span class="n">configure</span>
</span></span><span class="line"><span class="cl"><span class="n">make</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>利用uncramfs_all.sh拆120200.squashfs</p>
<p>发现/tmp里有个backdoor文件，这也太明显了，不过要是藏起来可能还真找不着</p>
<p>拖ida分析</p>
<p>先看string窗口直接就看到了 echo.byethost51.com</p>
<p>盲猜就是题目要的服务器地址，点进去看到变量名commServer，确信</p>
<p>查交叉引用找到了ininConnextion()函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">initConnection</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="o">*</span><span class="n">v0</span><span class="p">;</span> <span class="c1">// r0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">s</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span> <span class="c1">// [sp+4h] [bp-208h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [sp+204h] [bp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nf">memset</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">s</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">mainCommSock</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">close</span><span class="p">(</span><span class="n">mainCommSock</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">mainCommSock</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">currentServer</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">++</span><span class="n">currentServer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="n">currentServer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">strcpy</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">commServer</span><span class="p">)[</span><span class="n">currentServer</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span> <span class="o">=</span> <span class="mi">36667</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="nf">strchr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">58</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v0</span> <span class="o">=</span> <span class="nf">strchr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">58</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">v3</span> <span class="o">=</span> <span class="nf">atoi</span><span class="p">(</span><span class="n">v0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="nf">strchr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">58</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">mainCommSock</span> <span class="o">=</span> <span class="nf">socket</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nf">connectTimeout</span><span class="p">(</span><span class="n">mainCommSock</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>盲猜端口号就是v3=36667，实在太像了</p>
<p>于是flag{MD5(echo.byethost51.com:36667)}=flag{33a422c45d551ac6e4756f59812a954b}</p>
<p>correct！</p>
<h1 id="第五周">第五周</h1>
<p>2021-11-29
补上周，虽迟但到</p>
<h2 id="0x00-ddctf-android-easy">0x00 DDCTF Android Easy</h2>
<p>下载附件是个zip</p>
<p>后缀改为apk用jeb打开</p>
<p>打开FlagActivity文件看java</p>
<p>甚至都不用算((
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-7184b6e41bfb4b4ba2e499dba013585b.png"
        data-srcset="/upload/2022/02/image-7184b6e41bfb4b4ba2e499dba013585b.png, /upload/2022/02/image-7184b6e41bfb4b4ba2e499dba013585b.png 1.5x, /upload/2022/02/image-7184b6e41bfb4b4ba2e499dba013585b.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-7184b6e41bfb4b4ba2e499dba013585b.png"
        title="image" /></p>
<p><a href="mailto:flag%7bDDCTF-3ad60811d87c4a2dba0ef651b2d93476@didichuxing.com" rel="">flag{DDCTF-3ad60811d87c4a2dba0ef651b2d93476@didichuxing.com</a>}</p>
<h2 id="0x01-welcome-to-jni">0x01 WELCOME TO JNI</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">【维基百科】
</span></span><span class="line"><span class="cl">JNI （Java Native Interface，Java本地接口）是一种编程框架，使得Java虚拟机中的Java程序可以调用本地应用/或库，也可以被其他程序调用。 本地程序一般是用其它语言（C、C++或汇编语言等）编写的，并且被编译为基于本机硬件和操作系统的程序。
</span></span></code></pre></td></tr></table>
</div>
</div><p>下载附件是apk，直接进jeb，打开MainActivity</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">static</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">&#34;native-lib&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">native</span> <span class="kt">boolean</span> <span class="nf">loginUtils</span><span class="o">(</span><span class="n">String</span> <span class="n">arg1</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>  <span class="c1">// androidx.appcompat.app.AppCompatActivity
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">setContentView</span><span class="o">(</span><span class="mh">0x7F0B001C</span><span class="o">);</span>  <span class="c1">// layout:activity_main
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">this</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="mh">0x7F080057</span><span class="o">).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>  <span class="c1">// id:button
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nd">@Override</span>  <span class="c1">// android.view.View$OnClickListener
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">loginUtils</span><span class="o">(((</span><span class="n">EditText</span><span class="o">)</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="mh">0x7F0800B5</span><span class="o">)).</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>  <span class="c1">// id:inputBox
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">getApplicationContext</span><span class="o">(),</span> <span class="n">ok</span> <span class="o">?</span> <span class="s">&#34;RIGHT!!!!&#34;</span> <span class="o">:</span> <span class="s">&#34;WRONG!!!!&#34;</span><span class="o">,</span> <span class="mi">1</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">});</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>经含树师傅指点得知<code>stem.loadLibrary(&quot;native-lib&quot;);</code>就是JNI的标志</p>
<p>把附件后缀改为zip，打开lib文件夹，里面即native-lib</p>
<p>四个文件夹内容基本一样，只是架构不同</p>
<p>随便拖一个进ida（一定要先解压。。。）</p>
<p>查string就能看到flag{welcome_to_naive_lib!}</p>
<h2 id="0x02-codegate-ctf-redvelvet">0x02 Codegate CTF Redvelvet</h2>
<p>die查，elf64，进ida，函数列表找main</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">v40 = __readfsqword(40u);
</span></span><span class="line"><span class="cl">  strcpy(s2, &#34;0a435f46288bb5a764d13fca6c901d3750cee73fd7689ce79ef6dc0ff8f380e5&#34;);
</span></span><span class="line"><span class="cl">  v36 = 0LL;
</span></span><span class="line"><span class="cl">  v37 = 0LL;
</span></span><span class="line"><span class="cl">  v38 = 0LL;
</span></span><span class="line"><span class="cl">  v39 = 0;
</span></span><span class="line"><span class="cl">  printf(&#34;Your flag : &#34;);
</span></span><span class="line"><span class="cl">  fgets(&amp;s, 27, edata);
</span></span><span class="line"><span class="cl">  func1(s, v8);
</span></span><span class="line"><span class="cl">  func2((unsigned int)v8, (unsigned int)v9);
</span></span><span class="line"><span class="cl">  func3((unsigned int)v9, (unsigned int)v10);
</span></span><span class="line"><span class="cl">  func4((unsigned int)v10, (unsigned int)v11);
</span></span><span class="line"><span class="cl">  func5((unsigned int)v11, (unsigned int)v12);
</span></span><span class="line"><span class="cl">  func6((unsigned int)v12, (unsigned int)v13, (unsigned int)v14);
</span></span><span class="line"><span class="cl">  func7((unsigned int)v14, (unsigned int)v15, (unsigned int)v16);
</span></span><span class="line"><span class="cl">  func8((unsigned int)v16, (unsigned int)v17, (unsigned int)v18);
</span></span><span class="line"><span class="cl">  func9((unsigned int)v18, (unsigned int)v19, (unsigned int)v20);
</span></span><span class="line"><span class="cl">  func10((unsigned int)v20, (unsigned int)v21, (unsigned int)v22);
</span></span><span class="line"><span class="cl">  func11((unsigned int)v22, (unsigned int)v23, (unsigned int)v24);
</span></span><span class="line"><span class="cl">  func12((unsigned int)v24, (unsigned int)v25, (unsigned int)v26);
</span></span><span class="line"><span class="cl">  func13((unsigned int)v26, (unsigned int)v27, (unsigned int)v28);
</span></span><span class="line"><span class="cl">  func14((unsigned int)v28, (unsigned int)v29, (unsigned int)v30);
</span></span><span class="line"><span class="cl">  func15((unsigned int)v30, (unsigned int)v31, (unsigned int)v32);
</span></span><span class="line"><span class="cl">  SHA256_Init((__int64)v6);
</span></span><span class="line"><span class="cl">  v3 = strlen(&amp;s);
</span></span><span class="line"><span class="cl">  SHA256_Update(v6, &amp;s, v3);
</span></span><span class="line"><span class="cl">  SHA256_Final(v33, v6);
</span></span><span class="line"><span class="cl">  for ( i = 0; i &lt;= 31; ++i )
</span></span><span class="line"><span class="cl">    sprintf(&amp;s1[2 * i], &#34;%02x&#34;, (unsigned __int8)v33[i]);
</span></span><span class="line"><span class="cl">  if ( strcmp(s1, s2) )
</span></span><span class="line"><span class="cl">    exit(1);
</span></span><span class="line"><span class="cl">  printf(&#34;flag : {\&#34; %s \&#34;}\n&#34;, &amp;s);
</span></span><span class="line"><span class="cl">  return 0;
</span></span></code></pre></td></tr></table>
</div>
</div><p>基本逻辑是对输入走15个function，然后SHA256加密和s2比较</p>
<p>直接上angr</p>
<p>但这里需要注意，SHA256不可逆，所以find直接设在cmp处angr算不出来</p>
<p>而从SHA256之前到cmp只有一条路，所以find设在加密之前就行了,而avoid设在exit()函数处就行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">In [1]: import angr
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [2]: proj = angr.Project(&#39;./RedVelvet&#39;,auto_load_libs=False)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [3]: state = proj.factory.entry_state()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [4]: simgr = proj.factory.simgr(state)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [5]: simgr.explore(find=0x401537,avoid=0x4007D0)
</span></span></code></pre></td></tr></table>
</div>
</div><p>提示<code>Out[5]: &lt;SimulationManager with 1 found, 63 avoid&gt;</code></p>
<p>输出</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">In [6]: print(simgr.found[0].posix.dumps(0))
</span></span><span class="line"><span class="cl">b&#39;What_You_Wanna_Be?:)_la_la&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这里说明一下，上面的是正确答案</p>
<p>但其实我第一次跑出来是<code>b'What_You_Wanna_Be?:)_lc_la</code>,差了一个字母</p>
<p>当我写这篇wp时又跑了一遍，答案却是对的</p>
<p>两次脚本完全一样，angr也都没提示多解，但输出却不同</p>
<p>这才印证了RX师傅所说，粘几张聊天记录
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-06e7926e7fac4f2684a9fcb2444132c0.png"
        data-srcset="/upload/2022/02/image-06e7926e7fac4f2684a9fcb2444132c0.png, /upload/2022/02/image-06e7926e7fac4f2684a9fcb2444132c0.png 1.5x, /upload/2022/02/image-06e7926e7fac4f2684a9fcb2444132c0.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-06e7926e7fac4f2684a9fcb2444132c0.png"
        title="image" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-e0070c242c044f32a6d3526dcd285b64.png"
        data-srcset="/upload/2022/02/image-e0070c242c044f32a6d3526dcd285b64.png, /upload/2022/02/image-e0070c242c044f32a6d3526dcd285b64.png 1.5x, /upload/2022/02/image-e0070c242c044f32a6d3526dcd285b64.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-e0070c242c044f32a6d3526dcd285b64.png"
        title="image" /></p>
<p>用我的话来说就是：</p>
<p>1.angr对于已经走通的路不会再走第二遍</p>
<p>2.每一次先走哪条路（得到哪个答案）是随机的</p>
<p>所以出问题时（angr计算不准确）大可以多来两遍（</p>
<h1 id="第四周">第四周</h1>
<p>2021-11-20</p>
<h3 id="0x00-dmctf2020-re3">0x00 DMCTF2020 re3</h3>
<blockquote>
<p>一种常见的算法。</p>
</blockquote>
<p>die查，ELF64，进ida</p>
<p>结合tips使用Findcrypt插件</p>
<p>函数列表定位main函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">__int64 __fastcall main(int a1, char **a2, char **a3)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  unsigned int v3; // eax
</span></span><span class="line"><span class="cl">  int i; // [rsp+1Ch] [rbp-C4h]
</span></span><span class="line"><span class="cl">  char v6[96]; // [rsp+20h] [rbp-C0h] BYREF
</span></span><span class="line"><span class="cl">  char v7[16]; // [rsp+80h] [rbp-60h] BYREF
</span></span><span class="line"><span class="cl">  char s[32]; // [rsp+90h] [rbp-50h] BYREF
</span></span><span class="line"><span class="cl">  char s1[40]; // [rsp+B0h] [rbp-30h] BYREF
</span></span><span class="line"><span class="cl">  unsigned __int64 v10; // [rsp+D8h] [rbp-8h]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  v10 = __readfsqword(0x28u);
</span></span><span class="line"><span class="cl">  puts(::s);
</span></span><span class="line"><span class="cl">  memset(s, 0, 0x14uLL);
</span></span><span class="line"><span class="cl">  read(0, s, 5uLL);
</span></span><span class="line"><span class="cl">  sub_90A(v6);
</span></span><span class="line"><span class="cl">  v3 = strlen(s);
</span></span><span class="line"><span class="cl">  sub_956(v6, s, v3);
</span></span><span class="line"><span class="cl">  sub_AA4(v6, v7);
</span></span><span class="line"><span class="cl">  for ( i = 0; i &lt;= 15; ++i )
</span></span><span class="line"><span class="cl">    sprintf(&amp;s1[2 * i], &#34;%02x&#34;, (unsigned __int8)v7[i]);
</span></span><span class="line"><span class="cl">  if ( !strcmp(s1, Big_Numbers1_203060) )
</span></span><span class="line"><span class="cl">    printf(&#34;right&#34;);
</span></span><span class="line"><span class="cl">  getchar();
</span></span><span class="line"><span class="cl">  return 0LL;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Findcrypt结果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.data:0000000000203060    global    Big_Numbers1_203060    $c0    b&#39;21232f297a57a5a743894a0e4a801fc3&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>难道有种算法叫bignumbers？</p>
<p>百度无果，于是尝试搞懂加密逻辑，手动逆（天真.jpg)</p>
<p>然后就没有然后了（</p>
<p>偷看师傅们的题解,原来bignumbers是MD5的密文？？？</p>
<p>网站撞出flag{admin}</p>
<h2 id="0x01-actf2020-oruga">0x01 ACTF2020 Oruga</h2>
<blockquote>
<p>又是熟悉的迷宫……等下这是什么东西？
die查，Elf64，进ida</p>
</blockquote>
<p>迷宫逻辑函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">_BOOL8 __fastcall sub_78A(__int64 a1)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  int v2; // [rsp+Ch] [rbp-Ch]
</span></span><span class="line"><span class="cl">  int v3; // [rsp+10h] [rbp-8h]
</span></span><span class="line"><span class="cl">  int v4; // [rsp+14h] [rbp-4h]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  v2 = 0;
</span></span><span class="line"><span class="cl">  v3 = 5;
</span></span><span class="line"><span class="cl">  v4 = 0;
</span></span><span class="line"><span class="cl">  while ( byte_201020[v2] != 33 )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    v2 -= v4;
</span></span><span class="line"><span class="cl">    if ( *(_BYTE *)(v3 + a1) != &#39;W&#39; || v4 == -16 )
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      if ( *(_BYTE *)(v3 + a1) != &#39;E&#39; || v4 == 1 )
</span></span><span class="line"><span class="cl">      {
</span></span><span class="line"><span class="cl">        if ( *(_BYTE *)(v3 + a1) != &#39;M&#39; || v4 == 16 )
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">          if ( *(_BYTE *)(v3 + a1) != &#39;J&#39; || v4 == -1 )
</span></span><span class="line"><span class="cl">            return 0LL;
</span></span><span class="line"><span class="cl">          v4 = -1;
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        else
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">          v4 = 16;
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">      }
</span></span><span class="line"><span class="cl">      else
</span></span><span class="line"><span class="cl">      {
</span></span><span class="line"><span class="cl">        v4 = 1;
</span></span><span class="line"><span class="cl">      }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    else
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      v4 = -16;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    ++v3;
</span></span><span class="line"><span class="cl">    while ( !byte_201020[v2] )
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      if ( v4 == -1 &amp;&amp; (v2 &amp; 0xF) == 0 )
</span></span><span class="line"><span class="cl">        return 0LL;
</span></span><span class="line"><span class="cl">      if ( v4 == 1 &amp;&amp; v2 % 16 == 15 )
</span></span><span class="line"><span class="cl">        return 0LL;
</span></span><span class="line"><span class="cl">      if ( v4 == 16 &amp;&amp; (unsigned int)(v2 - 240) &lt;= 0xF )
</span></span><span class="line"><span class="cl">        return 0LL;
</span></span><span class="line"><span class="cl">      if ( v4 == -16 &amp;&amp; (unsigned int)(v2 + 15) &lt;= 0x1E )
</span></span><span class="line"><span class="cl">        return 0LL;
</span></span><span class="line"><span class="cl">      v2 += v4;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  return *(_BYTE *)(v3 + a1) == 125;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看出byte_201020是地图，共256byte，即16*16的地图</p>
<p>v2是当前所在的位置，v4是偏移量，1-right，-1-left，16-down，-16-up</p>
<p>上面的while里四个if可以直接对应else给v4赋值，即W-up E-right M-down J-left</p>
<p>下面的while函数里四个if应该是边界判断</p>
<p>然后循环一直往一个方向走，直到碰到字符</p>
<p>知道了这些，才能搞懂上面四个if里||v4==xx这个条件是在干啥</p>
<p>可以发现这个条件和下面else里给v4的赋值是一样的</p>
<p>即如果下一步和上一步是一样的，但上一步已经走到了这个方向所能走的最远处，这一步就是无效的</p>
<p>如果出现无效的重复命令，if判断会一路畅通，直接return 0</p>
<p>至此，手动走地图得flag：actf{MEWEMEWJMEWJM}
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-3a60818102104b73bd843b21b865d4de.png"
        data-srcset="/upload/2022/02/image-3a60818102104b73bd843b21b865d4de.png, /upload/2022/02/image-3a60818102104b73bd843b21b865d4de.png 1.5x, /upload/2022/02/image-3a60818102104b73bd843b21b865d4de.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-3a60818102104b73bd843b21b865d4de.png"
        title="image" /></p>
<h2 id="002-网鼎杯2020-signal">0×02 网鼎杯2020 signal</h2>
<blockquote>
<p>尝试一下某个自动化逆向工具？</p>
</blockquote>
<p>感谢RX细心又耐心讲解符号执行</p>
<p>angr直接搞他</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">project = angr.Project(&#39;./signal.exe&#39;,auto_load_libs = False)
</span></span><span class="line"><span class="cl">state = project.factory.entry_state()
</span></span><span class="line"><span class="cl">simgr = project.factory.simgr(state)
</span></span><span class="line"><span class="cl">simgr.explore(find = 0x40179E,avoid =0x401539)
</span></span><span class="line"><span class="cl">print(simgr.found[0].posix.dumps(0))
</span></span></code></pre></td></tr></table>
</div>
</div><p>得flag{757515121f3d478}，真香</p>
<h1 id="第三周">第三周</h1>
<p>2021-11-13</p>
<h2 id="000-suctf2019-signin">0×00 SUCTF2019 Signin</h2>
<blockquote>
<p>你认识这个算法嘛</p>
</blockquote>
<p>不认识，然后根据题解先去学RSA和gmpy2库，断断续续学了几天（（</p>
<p>贴个链接吧，便于以后复习</p>
<p><a href="https://blog.csdn.net/dbs1215/article/details/48953589" target="_blank" rel="noopener noreffer ">RSA</a>    <a href="https://blog.csdn.net/weixin_43790779/article/details/108473984" title="gmpy2库常见函数" target="_blank" rel="noopener noreffer ">gmpy2库常见函数</a></p>
<p>die查壳，无，然后进ida，直接根据函数列表定位main函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a2</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">v4</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span> <span class="c1">// [rsp+0h] [rbp-4A0h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v5</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span> <span class="c1">// [rsp+10h] [rbp-490h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v6</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span> <span class="c1">// [rsp+20h] [rbp-480h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v7</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span> <span class="c1">// [rsp+30h] [rbp-470h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v8</span><span class="p">[</span><span class="mi">112</span><span class="p">];</span> <span class="c1">// [rsp+40h] [rbp-460h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v9</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span> <span class="c1">// [rsp+B0h] [rbp-3F0h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// [rsp+498h] [rbp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v10</span> <span class="o">=</span> <span class="nf">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;[sign in]&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;[input your flag]: &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">__isoc99_scanf</span><span class="p">(</span><span class="s">&#34;%99s&#34;</span><span class="p">,</span> <span class="n">v8</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">sub_96A</span><span class="p">(</span><span class="n">v8</span><span class="p">,</span> <span class="n">v9</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">__gmpz_init_set_str</span><span class="p">(</span><span class="n">v7</span><span class="p">,</span> <span class="s">&#34;ad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35&#34;</span><span class="p">,</span> <span class="mi">16LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">__gmpz_init_set_str</span><span class="p">(</span><span class="n">v6</span><span class="p">,</span> <span class="n">v9</span><span class="p">,</span> <span class="mi">16LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">__gmpz_init_set_str</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span> <span class="s">&#34;103461035900816914121390101299049044413950405173712170434161686539878160984549&#34;</span><span class="p">,</span> <span class="mi">10LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">__gmpz_init_set_str</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="s">&#34;65537&#34;</span><span class="p">,</span> <span class="mi">10LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">__gmpz_powm</span><span class="p">(</span><span class="n">v6</span><span class="p">,</span> <span class="n">v6</span><span class="p">,</span> <span class="n">v5</span><span class="p">,</span> <span class="n">v4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="nf">__gmpz_cmp</span><span class="p">(</span><span class="n">v6</span><span class="p">,</span> <span class="n">v7</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;GG!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;TTTTTTTTTTql!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>根据RSA的形式稍微重命名一下变量</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  v10 = __readfsqword(0x28u);
</span></span><span class="line"><span class="cl">  puts(&#34;[sign in]&#34;);
</span></span><span class="line"><span class="cl">  printf(&#34;[input your flag]: &#34;);
</span></span><span class="line"><span class="cl">  __isoc99_scanf(&#34;%99s&#34;, input);
</span></span><span class="line"><span class="cl">  sub_96A(input, v9);
</span></span><span class="line"><span class="cl">  __gmpz_init_set_str(c, &#34;ad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35&#34;, 16LL);
</span></span><span class="line"><span class="cl">  __gmpz_init_set_str(calc, v9, 16LL);
</span></span><span class="line"><span class="cl">  __gmpz_init_set_str(n, &#34;103461035900816914121390101299049044413950405173712170434161686539878160984549&#34;, 10LL);
</span></span><span class="line"><span class="cl">  __gmpz_init_set_str(e, &#34;65537&#34;, 10LL);
</span></span><span class="line"><span class="cl">  __gmpz_powm(calc, calc, e, n);
</span></span><span class="line"><span class="cl">  if ( (unsigned int)__gmpz_cmp(calc, c) )      // calc是根据input计算出的密文，c是实际的密文
</span></span><span class="line"><span class="cl">    puts(&#34;GG!&#34;);
</span></span><span class="line"><span class="cl">  else
</span></span><span class="line"><span class="cl">    puts(&#34;TTTTTTTTTTql!&#34;);
</span></span><span class="line"><span class="cl">  return 0LL;
</span></span></code></pre></td></tr></table>
</div>
</div><p>先用yafu分解n，由于写这篇文章时是第二次分解n所以比较快</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\Users\DX3906&gt;D:\reserve\yafu\yafu-x64.exe
</span></span><span class="line"><span class="cl">factor(103461035900816914121390101299049044413950405173712170434161686539878160984549)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fac: factoring 103461035900816914121390101299049044413950405173712170434161686539878160984549
</span></span><span class="line"><span class="cl">fac: using pretesting plan: normal
</span></span><span class="line"><span class="cl">fac: no tune info: using qs/gnfs crossover of 95 digits
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">starting SIQS on c78: 103461035900816914121390101299049044413950405173712170434161686539878160984549
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">==== sieving in progress (1 thread):   36224 relations needed ====
</span></span><span class="line"><span class="cl">====           Press ctrl-c to abort and save state           ====
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SIQS elapsed time = 1.0985 seconds.
</span></span><span class="line"><span class="cl">Total factoring time = 1.1195 seconds
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">***factors found***
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">P39 = 282164587459512124844245113950593348271
</span></span><span class="line"><span class="cl">P39 = 366669102002966856876605669837014229419
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ans = 1
</span></span></code></pre></td></tr></table>
</div>
</div><p>得到 p=282164587459512124844245113950593348271 q=366669102002966856876605669837014229419</p>
<p>已知n,p,q,e，先求d</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">gmpy2</span>
</span></span><span class="line"><span class="cl"><span class="n">n</span><span class="o">=</span><span class="mi">103461035900816914121390101299049044413950405173712170434161686539878160984549</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">=</span><span class="mi">282164587459512124844245113950593348271</span>
</span></span><span class="line"><span class="cl"><span class="n">q</span><span class="o">=</span><span class="mi">366669102002966856876605669837014229419</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span><span class="o">=</span><span class="mi">65537</span>
</span></span><span class="line"><span class="cl"><span class="n">l</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span><span class="o">=</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>已知n,d,c,求明文</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">c</span><span class="o">=</span><span class="mh">0xad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="o">=</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">powmod</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># b&#39;suctf{Pwn_@_hundred_years}&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="001-flareon6-overlang">0×01 FlareOn6 Overlang</h2>
<p>die查看文件信息，PE32，拖进ida</p>
<p>竟然就三个函数，start函数应该是主要的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="kr">__stdcall</span> <span class="nf">start</span><span class="p">(</span><span class="kt">int</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a3</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHAR</span> <span class="n">Text</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span> <span class="c1">// [esp+0h] [ebp-84h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [esp+80h] [ebp-4h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span> <span class="o">=</span> <span class="nf">sub_401160</span><span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unk_402008</span><span class="p">,</span> <span class="mi">28</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">Text</span><span class="p">[</span><span class="n">v6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">MessageBoxA</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">Caption</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>sub_401160函数像是把unk_402008的前28位复制给Text，然后通过MessageBoxA输出Text和Caption</p>
<p>这里我们可以打开unk_402008看看</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.rdata:00402008 unk_402008      db 0E0h                 ; DATA XREF: start+B↑o
</span></span><span class="line"><span class="cl">.rdata:00402009                 db  81h
</span></span><span class="line"><span class="cl">.rdata:0040200A                 db  89h
</span></span><span class="line"><span class="cl">.rdata:0040200B                 db 0C0h
</span></span><span class="line"><span class="cl">.rdata:0040200C                 db 0A0h
</span></span><span class="line"><span class="cl">.rdata:0040200D                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:0040200E                 db 0AEh
</span></span><span class="line"><span class="cl">.rdata:0040200F                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:00402010                 db  81h
</span></span><span class="line"><span class="cl">.rdata:00402011                 db 0A5h
</span></span><span class="line"><span class="cl">.rdata:00402012                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:00402013                 db 0B6h
</span></span><span class="line"><span class="cl">.rdata:00402014                 db 0F0h
</span></span><span class="line"><span class="cl">.rdata:00402015                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:00402016                 db  81h
</span></span><span class="line"><span class="cl">.rdata:00402017                 db 0A5h
</span></span><span class="line"><span class="cl">.rdata:00402018                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:00402019                 db  81h
</span></span><span class="line"><span class="cl">.rdata:0040201A                 db 0B2h
</span></span><span class="line"><span class="cl">.rdata:0040201B                 db 0F0h
</span></span><span class="line"><span class="cl">.rdata:0040201C                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:0040201D                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:0040201E                 db 0A0h
</span></span><span class="line"><span class="cl">.rdata:0040201F                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:00402020                 db  81h
</span></span><span class="line"><span class="cl">.rdata:00402021                 db 0A2h
</span></span><span class="line"><span class="cl">.rdata:00402022                 db  72h ; r
</span></span><span class="line"><span class="cl">.rdata:00402023                 db  6Fh ; o
</span></span><span class="line"><span class="cl">.rdata:00402024                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:00402025                 db 0ABh
</span></span><span class="line"><span class="cl">.rdata:00402026                 db  65h ; e
</span></span><span class="line"><span class="cl">.rdata:00402027                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:00402028                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:00402029                 db 0A0h
</span></span><span class="line"><span class="cl">.rdata:0040202A                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:0040202B                 db  81h
</span></span><span class="line"><span class="cl">.rdata:0040202C                 db 0B4h
</span></span><span class="line"><span class="cl">.rdata:0040202D                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:0040202E                 db  81h
</span></span><span class="line"><span class="cl">.rdata:0040202F                 db 0A8h
</span></span><span class="line"><span class="cl">.rdata:00402030                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:00402031                 db 0A5h
</span></span><span class="line"><span class="cl">.rdata:00402032                 db  20h
</span></span><span class="line"><span class="cl">.rdata:00402033                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:00402034                 db 0A5h
</span></span><span class="line"><span class="cl">.rdata:00402035                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:00402036                 db  81h
</span></span><span class="line"><span class="cl">.rdata:00402037                 db 0AEh
</span></span><span class="line"><span class="cl">.rdata:00402038                 db  63h ; c
</span></span><span class="line"><span class="cl">.rdata:00402039                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:0040203A                 db 0AFh
</span></span><span class="line"><span class="cl">.rdata:0040203B                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:0040203C                 db  81h
</span></span><span class="line"><span class="cl">.rdata:0040203D                 db 0A4h
</span></span><span class="line"><span class="cl">.rdata:0040203E                 db 0F0h
</span></span><span class="line"><span class="cl">.rdata:0040203F                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:00402040                 db  81h
</span></span><span class="line"><span class="cl">.rdata:00402041                 db 0A9h
</span></span><span class="line"><span class="cl">.rdata:00402042                 db  6Eh ; n
</span></span><span class="line"><span class="cl">.rdata:00402043                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:00402044                 db 0A7h
</span></span><span class="line"><span class="cl">.rdata:00402045                 db 0C0h
</span></span><span class="line"><span class="cl">.rdata:00402046                 db 0BAh
</span></span><span class="line"><span class="cl">.rdata:00402047                 db  20h
</span></span><span class="line"><span class="cl">.rdata:00402048                 db  49h ; I
</span></span><span class="line"><span class="cl">.rdata:00402049                 db 0F0h
</span></span><span class="line"><span class="cl">.rdata:0040204A                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:0040204B                 db  81h
</span></span><span class="line"><span class="cl">.rdata:0040204C                 db  9Fh
</span></span><span class="line"><span class="cl">.rdata:0040204D                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:0040204E                 db 0A1h
</span></span><span class="line"><span class="cl">.rdata:0040204F                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:00402050                 db  9Fh
</span></span><span class="line"><span class="cl">.rdata:00402051                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:00402052                 db  8Dh
</span></span><span class="line"><span class="cl">.rdata:00402053                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:00402054                 db  81h
</span></span><span class="line"><span class="cl">.rdata:00402055                 db  9Fh
</span></span><span class="line"><span class="cl">.rdata:00402056                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:00402057                 db 0B4h
</span></span><span class="line"><span class="cl">.rdata:00402058                 db 0F0h
</span></span><span class="line"><span class="cl">.rdata:00402059                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:0040205A                 db  81h
</span></span><span class="line"><span class="cl">.rdata:0040205B                 db  9Fh
</span></span><span class="line"><span class="cl">.rdata:0040205C                 db 0F0h
</span></span><span class="line"><span class="cl">.rdata:0040205D                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:0040205E                 db  81h
</span></span><span class="line"><span class="cl">.rdata:0040205F                 db 0A8h
</span></span><span class="line"><span class="cl">.rdata:00402060                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:00402061                 db  9Fh
</span></span><span class="line"><span class="cl">.rdata:00402062                 db 0F0h
</span></span><span class="line"><span class="cl">.rdata:00402063                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:00402064                 db  81h
</span></span><span class="line"><span class="cl">.rdata:00402065                 db 0A5h
</span></span><span class="line"><span class="cl">.rdata:00402066                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:00402067                 db  81h
</span></span><span class="line"><span class="cl">.rdata:00402068                 db  9Fh
</span></span><span class="line"><span class="cl">.rdata:00402069                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:0040206A                 db 0A5h
</span></span><span class="line"><span class="cl">.rdata:0040206B                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:0040206C                 db  81h
</span></span><span class="line"><span class="cl">.rdata:0040206D                 db  9Fh
</span></span><span class="line"><span class="cl">.rdata:0040206E                 db 0F0h
</span></span><span class="line"><span class="cl">.rdata:0040206F                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:00402070                 db  81h
</span></span><span class="line"><span class="cl">.rdata:00402071                 db 0AEh
</span></span><span class="line"><span class="cl">.rdata:00402072                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:00402073                 db  9Fh
</span></span><span class="line"><span class="cl">.rdata:00402074                 db 0F0h
</span></span><span class="line"><span class="cl">.rdata:00402075                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:00402076                 db  81h
</span></span><span class="line"><span class="cl">.rdata:00402077                 db  83h
</span></span><span class="line"><span class="cl">.rdata:00402078                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:00402079                 db  9Fh
</span></span><span class="line"><span class="cl">.rdata:0040207A                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:0040207B                 db  81h
</span></span><span class="line"><span class="cl">.rdata:0040207C                 db 0AFh
</span></span><span class="line"><span class="cl">.rdata:0040207D                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:0040207E                 db  81h
</span></span><span class="line"><span class="cl">.rdata:0040207F                 db  9Fh
</span></span><span class="line"><span class="cl">.rdata:00402080                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:00402081                 db  84h
</span></span><span class="line"><span class="cl">.rdata:00402082                 db  5Fh ; _
</span></span><span class="line"><span class="cl">.rdata:00402083                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:00402084                 db  81h
</span></span><span class="line"><span class="cl">.rdata:00402085                 db 0A9h
</span></span><span class="line"><span class="cl">.rdata:00402086                 db 0F0h
</span></span><span class="line"><span class="cl">.rdata:00402087                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:00402088                 db  81h
</span></span><span class="line"><span class="cl">.rdata:00402089                 db  9Fh
</span></span><span class="line"><span class="cl">.rdata:0040208A                 db  6Eh ; n
</span></span><span class="line"><span class="cl">.rdata:0040208B                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:0040208C                 db  81h
</span></span><span class="line"><span class="cl">.rdata:0040208D                 db  9Fh
</span></span><span class="line"><span class="cl">.rdata:0040208E                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:0040208F                 db  81h
</span></span><span class="line"><span class="cl">.rdata:00402090                 db 0A7h
</span></span><span class="line"><span class="cl">.rdata:00402091                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:00402092                 db  81h
</span></span><span class="line"><span class="cl">.rdata:00402093                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:00402094                 db 0F0h
</span></span><span class="line"><span class="cl">.rdata:00402095                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:00402096                 db  81h
</span></span><span class="line"><span class="cl">.rdata:00402097                 db 0A6h
</span></span><span class="line"><span class="cl">.rdata:00402098                 db 0F0h
</span></span><span class="line"><span class="cl">.rdata:00402099                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:0040209A                 db  81h
</span></span><span class="line"><span class="cl">.rdata:0040209B                 db 0ACh
</span></span><span class="line"><span class="cl">.rdata:0040209C                 db 0E0h
</span></span><span class="line"><span class="cl">.rdata:0040209D                 db  81h
</span></span><span class="line"><span class="cl">.rdata:0040209E                 db 0A1h
</span></span><span class="line"><span class="cl">.rdata:0040209F                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:004020A0                 db 0B2h
</span></span><span class="line"><span class="cl">.rdata:004020A1                 db 0C1h
</span></span><span class="line"><span class="cl">.rdata:004020A2                 db 0A5h
</span></span><span class="line"><span class="cl">.rdata:004020A3                 db 0F0h
</span></span><span class="line"><span class="cl">.rdata:004020A4                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:004020A5                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:004020A6                 db 0ADh
</span></span><span class="line"><span class="cl">.rdata:004020A7                 db 0F0h
</span></span><span class="line"><span class="cl">.rdata:004020A8                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:004020A9                 db  81h
</span></span><span class="line"><span class="cl">.rdata:004020AA                 db 0AFh
</span></span><span class="line"><span class="cl">.rdata:004020AB                 db  6Eh ; n
</span></span><span class="line"><span class="cl">.rdata:004020AC                 db 0C0h
</span></span><span class="line"><span class="cl">.rdata:004020AD                 db 0AEh
</span></span><span class="line"><span class="cl">.rdata:004020AE                 db 0F0h
</span></span><span class="line"><span class="cl">.rdata:004020AF                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:004020B0                 db  81h
</span></span><span class="line"><span class="cl">.rdata:004020B1                 db 0A3h
</span></span><span class="line"><span class="cl">.rdata:004020B2                 db  6Fh ; o
</span></span><span class="line"><span class="cl">.rdata:004020B3                 db 0F0h
</span></span><span class="line"><span class="cl">.rdata:004020B4                 db  80h ; €
</span></span><span class="line"><span class="cl">.rdata:004020B5                 db  81h
</span></span><span class="line"><span class="cl">.rdata:004020B6                 db 0ADh
</span></span><span class="line"><span class="cl">.rdata:004020B7                 db    0
</span></span></code></pre></td></tr></table>
</div>
</div><p>发现问题，这一串数据远不止28位，结合程序运行时的输出后面有个冒号</p>
<p>推测这串数据后半段就是flag，只是没有输出而已</p>
<p>于是找到函数sub_401160的汇编代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.text:004011C0                 push    ebp
</span></span><span class="line"><span class="cl">.text:004011C1                 mov     ebp, esp
</span></span><span class="line"><span class="cl">.text:004011C3                 sub     esp, 84h
</span></span><span class="line"><span class="cl">.text:004011C9                 push    1Ch
</span></span><span class="line"><span class="cl">.text:004011CB                 push    offset unk_402008
</span></span><span class="line"><span class="cl">.text:004011D0                 lea     eax, [ebp+Text]
</span></span><span class="line"><span class="cl">.text:004011D6                 push    eax
</span></span><span class="line"><span class="cl">.text:004011D7                 call    sub_401160
</span></span><span class="line"><span class="cl">.text:004011DC                 add     esp, 0Ch
</span></span><span class="line"><span class="cl">.text:004011DF                 mov     [ebp+var_4], eax
</span></span><span class="line"><span class="cl">.text:004011E2                 mov     ecx, [ebp+var_4]
</span></span><span class="line"><span class="cl">.text:004011E5                 mov     [ebp+ecx+Text], 0
</span></span><span class="line"><span class="cl">.text:004011ED                 push    0               ; uType
</span></span><span class="line"><span class="cl">.text:004011EF                 push    offset Caption  ; &#34;Output&#34;
</span></span><span class="line"><span class="cl">.text:004011F4                 lea     edx, [ebp+Text]
</span></span><span class="line"><span class="cl">.text:004011FA                 push    edx             ; lpText
</span></span><span class="line"><span class="cl">.text:004011FB                 push    0               ; hWnd
</span></span><span class="line"><span class="cl">.text:004011FD                 call    ds:MessageBoxA
</span></span><span class="line"><span class="cl">.text:00401203                 xor     eax, eax
</span></span><span class="line"><span class="cl">.text:00401205                 mov     esp, ebp
</span></span><span class="line"><span class="cl">.text:00401207                 pop     ebp
</span></span><span class="line"><span class="cl">.text:00401208                 retn    10h
</span></span></code></pre></td></tr></table>
</div>
</div><p>把第四行push 1ch patch成一个大点的数，这里我写成push 5ch</p>
<p>然后apply一下，重新打开exe，大功告成！
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-21ac6bf4a041420eb7b2ff1f6ead6fae.png"
        data-srcset="/upload/2022/02/image-21ac6bf4a041420eb7b2ff1f6ead6fae.png, /upload/2022/02/image-21ac6bf4a041420eb7b2ff1f6ead6fae.png 1.5x, /upload/2022/02/image-21ac6bf4a041420eb7b2ff1f6ead6fae.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-21ac6bf4a041420eb7b2ff1f6ead6fae.png"
        title="image" /></p>
<h3 id="002-bjdctf2020-easy">0×02 BJDCTF2020 easy</h3>
<blockquote>
<p>和上道题有异曲同工之处？</p>
</blockquote>
<p>die查，结果PE32，进ida</p>
<p>直接定位main函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">int __cdecl main(int argc, const char **argv, const char **envp)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  __time32_t Time; // [esp+10h] [ebp-3F0h] BYREF
</span></span><span class="line"><span class="cl">  struct tm *v5; // [esp+3FCh] [ebp-4h]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  __main();
</span></span><span class="line"><span class="cl">  time(&amp;Time);
</span></span><span class="line"><span class="cl">  v5 = localtime(&amp;Time);
</span></span><span class="line"><span class="cl">  puts(&#34;Can you find me?\n&#34;);
</span></span><span class="line"><span class="cl">  system(&#34;pause&#34;);
</span></span><span class="line"><span class="cl">  return 0;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>各种time给我整蒙了，特意百度查了一下发现好像真没什么用</p>
<p>和上一题有异曲同工之妙?直接去翻参数列表</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.text:00401725                 push    ebp
</span></span><span class="line"><span class="cl">.text:00401726                 mov     ebp, esp
</span></span><span class="line"><span class="cl">.text:00401728                 and     esp, 0FFFFFFF0h
</span></span><span class="line"><span class="cl">.text:0040172B                 sub     esp, 400h
</span></span><span class="line"><span class="cl">.text:00401731                 call    ___main
</span></span><span class="line"><span class="cl">.text:00401736                 lea     eax, [esp+400h+var_3F0]
</span></span><span class="line"><span class="cl">.text:0040173A                 mov     [esp+400h+Time], eax ; Time
</span></span><span class="line"><span class="cl">.text:0040173D                 call    _time
</span></span><span class="line"><span class="cl">.text:00401742                 lea     eax, [esp+400h+var_3F0]
</span></span><span class="line"><span class="cl">.text:00401746                 mov     [esp+400h+Time], eax ; Time
</span></span><span class="line"><span class="cl">.text:00401749                 call    _localtime
</span></span><span class="line"><span class="cl">.text:0040174E                 mov     [esp+400h+var_4], eax
</span></span><span class="line"><span class="cl">.text:00401755                 mov     [esp+400h+Time], offset Buffer ; &#34;Can you find me?\n&#34;
</span></span><span class="line"><span class="cl">.text:0040175C                 call    _puts
</span></span><span class="line"><span class="cl">.text:00401761                 mov     [esp+400h+Time], offset Command ; &#34;pause&#34;
</span></span><span class="line"><span class="cl">.text:00401768                 call    _system
</span></span><span class="line"><span class="cl">.text:0040176D                 mov     eax, 0
</span></span><span class="line"><span class="cl">.text:00401772                 leave
</span></span><span class="line"><span class="cl">.text:00401773                 retn
</span></span></code></pre></td></tr></table>
</div>
</div><p>也没发现什么有用的，毫无头绪</p>
<p>翻函数列表的时候发现了问题，就是这个_ques函数，</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">int ques()
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  int v0; // edx
</span></span><span class="line"><span class="cl">  int result; // eax
</span></span><span class="line"><span class="cl">  int v2[50]; // [esp+20h] [ebp-128h] BYREF
</span></span><span class="line"><span class="cl">  int v3; // [esp+E8h] [ebp-60h]
</span></span><span class="line"><span class="cl">  int v4[10]; // [esp+ECh] [ebp-5Ch]
</span></span><span class="line"><span class="cl">  int j; // [esp+114h] [ebp-34h]
</span></span><span class="line"><span class="cl">  __int64 v6; // [esp+118h] [ebp-30h]
</span></span><span class="line"><span class="cl">  int v7; // [esp+124h] [ebp-24h]
</span></span><span class="line"><span class="cl">  int v8; // [esp+128h] [ebp-20h]
</span></span><span class="line"><span class="cl">  int i; // [esp+12Ch] [ebp-1Ch]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  v3 = 2147122737;
</span></span><span class="line"><span class="cl">  v4[0] = 140540;
</span></span><span class="line"><span class="cl">  v4[1] = -2008399303;
</span></span><span class="line"><span class="cl">  v4[2] = 141956;
</span></span><span class="line"><span class="cl">  v4[3] = 139457077;
</span></span><span class="line"><span class="cl">  v4[4] = 262023;
</span></span><span class="line"><span class="cl">  v4[5] = -2008923597;
</span></span><span class="line"><span class="cl">  v4[6] = 143749;
</span></span><span class="line"><span class="cl">  v4[7] = 2118271985;
</span></span><span class="line"><span class="cl">  v4[8] = 143868;
</span></span><span class="line"><span class="cl">  for ( i = 0; i &lt;= 4; ++i )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    memset(v2, 0, sizeof(v2));
</span></span><span class="line"><span class="cl">    v8 = 0;
</span></span><span class="line"><span class="cl">    v7 = 0;
</span></span><span class="line"><span class="cl">    v0 = v4[2 * i];
</span></span><span class="line"><span class="cl">    LODWORD(v6) = *(&amp;v3 + 2 * i);
</span></span><span class="line"><span class="cl">    HIDWORD(v6) = v0;
</span></span><span class="line"><span class="cl">    while ( v6 &gt; 0 )
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      v2[v8++] = v6 % 2;
</span></span><span class="line"><span class="cl">      v6 /= 2i64;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    for ( j = 50; j &gt;= 0; --j )
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      if ( v2[j] )
</span></span><span class="line"><span class="cl">      {
</span></span><span class="line"><span class="cl">        if ( v2[j] == 1 )
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">          putchar(42);
</span></span><span class="line"><span class="cl">          ++v7;
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">      }
</span></span><span class="line"><span class="cl">      else
</span></span><span class="line"><span class="cl">      {
</span></span><span class="line"><span class="cl">        putchar(32);
</span></span><span class="line"><span class="cl">        ++v7;
</span></span><span class="line"><span class="cl">      }
</span></span><span class="line"><span class="cl">      if ( !(v7 % 5) )
</span></span><span class="line"><span class="cl">        putchar(32);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    result = putchar(10);
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  return result;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>从感觉上来说一般能看懂的都是有用的，然而按x查交叉引用的时候却显示没有地方调用它</p>
<p>于是盲猜前面没啥用的各种time函数就是让我patch的，搞他（我这里改了第11行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.text:00401725                 push    ebp
</span></span><span class="line"><span class="cl">.text:00401726                 mov     ebp, esp
</span></span><span class="line"><span class="cl">.text:00401728                 and     esp, 0FFFFFFF0h
</span></span><span class="line"><span class="cl">.text:0040172B                 sub     esp, 400h
</span></span><span class="line"><span class="cl">.text:00401731                 call    ___main
</span></span><span class="line"><span class="cl">.text:00401736                 lea     eax, [esp+400h+var_3F0]
</span></span><span class="line"><span class="cl">.text:0040173A                 mov     [esp+400h+Time], eax ; Time
</span></span><span class="line"><span class="cl">.text:0040173D                 call    _time
</span></span><span class="line"><span class="cl">.text:00401742                 lea     eax, [esp+400h+var_3F0]
</span></span><span class="line"><span class="cl">.text:00401746                 mov     [esp+400h+Time], eax ; Time
</span></span><span class="line"><span class="cl">.text:00401749                 call    _ques           ; Keypatch modified this from:
</span></span><span class="line"><span class="cl">.text:00401749                                         ;   call _localtime
</span></span><span class="line"><span class="cl">.text:0040174E                 mov     [esp+400h+var_4], eax
</span></span><span class="line"><span class="cl">.text:00401755                 mov     [esp+400h+Time], offset Buffer ; &#34;Can you find me?\n&#34;
</span></span><span class="line"><span class="cl">.text:0040175C                 call    _puts
</span></span><span class="line"><span class="cl">.text:00401761                 mov     [esp+400h+Time], offset Command ; &#34;pause&#34;
</span></span><span class="line"><span class="cl">.text:00401768                 call    _system
</span></span><span class="line"><span class="cl">.text:0040176D                 mov     eax, 0
</span></span><span class="line"><span class="cl">.text:00401772                 leave
</span></span><span class="line"><span class="cl">.text:00401773                 retn
</span></span></code></pre></td></tr></table>
</div>
</div><p>apply一下，然后重新运行exe，成功！</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-6b95eb4b15b74cf99825a9cc2ecb0b46.png"
        data-srcset="/upload/2022/02/image-6b95eb4b15b74cf99825a9cc2ecb0b46.png, /upload/2022/02/image-6b95eb4b15b74cf99825a9cc2ecb0b46.png 1.5x, /upload/2022/02/image-6b95eb4b15b74cf99825a9cc2ecb0b46.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-6b95eb4b15b74cf99825a9cc2ecb0b46.png"
        title="image" /></p>
<h1 id="第二周">第二周</h1>
<p>2021-11-05</p>
<h2 id="000-从-cnss-偷来的-smc">0×00 从 CNSS 偷来的 SMC</h2>
<blockquote>
<p>SMC是什么?</p>
</blockquote>
<p>看完tips尝试一下</p>
<p>string窗口定位主函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.text:00408ACE                 push    offset aPleaseInputYou ; &#34;Please input your code(less than 30 cha&#34;...
</span></span><span class="line"><span class="cl">.text:00408AD3                 call    sub_404629
</span></span><span class="line"><span class="cl">.text:00408AD8                 add     esp, 4
</span></span><span class="line"><span class="cl">.text:00408ADB                 push    64h ; &#39;d&#39;
</span></span><span class="line"><span class="cl">.text:00408ADD                 push    offset unk_4DFEF8
</span></span><span class="line"><span class="cl">.text:00408AE2                 push    offset aS       ; &#34;%s&#34;
</span></span><span class="line"><span class="cl">.text:00408AE7                 call    sub_4023EC
</span></span><span class="line"><span class="cl">.text:00408AEC                 add     esp, 0Ch
</span></span><span class="line"><span class="cl">.text:00408AEF                 push    offset loc_408B06
</span></span><span class="line"><span class="cl">.text:00408AF4                 push    138h
</span></span><span class="line"><span class="cl">.text:00408AF9                 push    offset loc_408B06
</span></span><span class="line"><span class="cl">.text:00408AFE                 call    sub_4022AC
</span></span><span class="line"><span class="cl">.text:00408B03                 add     esp, 0Ch
</span></span></code></pre></td></tr></table>
</div>
</div><p>定位问题函数sub_4022AC</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">int __cdecl sub_4088D0(int a1, int a2, int a3)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  int result; // eax
</span></span><span class="line"><span class="cl">  int i; // [esp+D0h] [ebp-8h]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  for ( i = 0; ; ++i )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    result = i;
</span></span><span class="line"><span class="cl">    if ( i &gt;= a2 )
</span></span><span class="line"><span class="cl">      break;
</span></span><span class="line"><span class="cl">    *(_BYTE *)(i + a3) = byte_4DF000 ^ *(_BYTE *)(i + a1);
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  return result;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>idaPython 搞他</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ida_bytes</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x138</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">patch_byte</span><span class="p">(</span><span class="mh">0x408B06</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">get_byte</span><span class="p">(</span><span class="mh">0x408B06</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">^</span><span class="mi">74</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>按照步骤来到函数头CreatFonction，结果就出问题了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">报错
</span></span><span class="line"><span class="cl">.text:00408B19: The function has undefined instruction/data at the specified address.
</span></span><span class="line"><span class="cl">Your request has been put in the autoanalysis queue.
</span></span></code></pre></td></tr></table>
</div>
</div><p>开始以为是前面哪里做错了，又重复了几遍，一样的结果</p>
<p>请教RX大神发现问题</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.text:00408B06                 mov     dword ptr [ebp-0Ch], 1
</span></span><span class="line"><span class="cl">.text:00408B0D                 mov     dword ptr [ebp-8], 1
</span></span><span class="line"><span class="cl">.text:00408B14                 push    4DFEF8h
</span></span><span class="line"><span class="cl">.text:00408B14 ; ---------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">.text:00408B19                 db 0E8h
</span></span><span class="line"><span class="cl">.text:00408B1A                 retn    0FF95h
</span></span><span class="line"><span class="cl">.text:00408B1A ; ---------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">.text:00408B1D                 db 0FFh
</span></span></code></pre></td></tr></table>
</div>
</div><p>这里ida识别错了</p>
<p>按c重新识别为code，一切正常了</p>
<p>重新CreateFunction接F5终于看到主函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main_0</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">signed</span> <span class="kt">int</span> <span class="n">j</span><span class="p">;</span> <span class="c1">// [esp+D4h] [ebp-3Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [esp+E0h] [ebp-30h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [esp+EFh] [ebp-21h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">signed</span> <span class="kt">int</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [esp+F8h] [ebp-18h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// [esp+104h] [ebp-Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// [esp+108h] [ebp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nf">sub_404629</span><span class="p">(</span><span class="s">&#34;Please input your code(less than 30 characters): &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">sub_4023EC</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">Str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">sub_4022AC</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="o">&amp;</span><span class="n">loc_408B06</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">&amp;</span><span class="n">loc_408B06</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v8</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v9</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span> <span class="o">=</span> <span class="nf">j__strlen</span><span class="p">(</span><span class="n">Str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">v7</span> <span class="o">==</span> <span class="mi">23</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">23</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">switch</span> <span class="p">(</span> <span class="n">Str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="sc">&#39;a&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">          <span class="o">--</span><span class="n">v9</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="sc">&#39;d&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">          <span class="o">++</span><span class="n">v9</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="sc">&#39;s&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">          <span class="o">++</span><span class="n">v8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="sc">&#39;w&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">          <span class="o">--</span><span class="n">v8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">          <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="n">aSE</span><span class="p">[</span><span class="mi">8</span> <span class="o">*</span> <span class="n">v8</span> <span class="o">+</span> <span class="n">v9</span><span class="p">]</span> <span class="o">==</span> <span class="mi">35</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="n">aSE</span><span class="p">[</span><span class="mi">8</span> <span class="o">*</span> <span class="n">v8</span> <span class="o">+</span> <span class="n">v9</span><span class="p">]</span> <span class="o">==</span> <span class="mi">69</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">v6</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">v6</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">v7</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">byte_4DF04C</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">^=</span> <span class="n">Str</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sub_404629</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">j__system</span><span class="p">(</span><span class="s">&#34;pause&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>经典地图题,aSE数组存地图，加回车得地图</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">########
</span></span><span class="line"><span class="cl">#S #   #
</span></span><span class="line"><span class="cl">##   # #
</span></span><span class="line"><span class="cl">#####  #
</span></span><span class="line"><span class="cl">#     ##
</span></span><span class="line"><span class="cl"># ####E#
</span></span><span class="line"><span class="cl">#      #
</span></span><span class="line"><span class="cl">########
</span></span></code></pre></td></tr></table>
</div>
</div><p>w s a d十分人性化，好评</p>
<p>第一次用py写脚本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;dsddwddssasaaaassdddddw&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">magic</span> <span class="o">=</span> <span class="p">[</span><span class="mi">39</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span><span class="mi">71</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">23</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span> <span class="nb">chr</span><span class="p">(</span> <span class="n">magic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># CNSS{Ea5y_SMC_&amp;_a_Ma2e}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="001-bytectf-2020-awd">0×01 ByteCTF 2020 AWD</h2>
<blockquote>
<p>TikTokAdmin 简单花指令</p>
</blockquote>
<p>题目劝退，学习了一波花指令是啥再来做题</p>
<p>根据题目，在string窗口查找Delete，找到了发生错误的部分</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.text:00000000000080D4 loc_80D4:                               ; CODE XREF: .text:000000000000805C↑j
</span></span><span class="line"><span class="cl">.text:00000000000080D4                 lea     rsi, aWeNeedToReconf ; &#34;We need to reconfirm the authority!&#34;
</span></span><span class="line"><span class="cl">.text:00000000000080DB                 lea     rdi, _ZSt4cout  ; std::cout
</span></span><span class="line"><span class="cl">.text:00000000000080E2                 call    __ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc ; std::operator&lt;&lt;&lt;std::char_traits&lt;char&gt;&gt;(std::ostream &amp;,char const*)
</span></span><span class="line"><span class="cl">.text:00000000000080E7                 mov     rdx, rax
</span></span><span class="line"><span class="cl">.text:00000000000080EA                 mov     rax, cs:_ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6__ptr
</span></span><span class="line"><span class="cl">.text:00000000000080F1                 mov     rsi, rax
</span></span><span class="line"><span class="cl">.text:00000000000080F4                 mov     rdi, rdx
</span></span><span class="line"><span class="cl">.text:00000000000080F7                 call    __ZNSolsEPFRSoS_E ; std::ostream::operator&lt;&lt;(std::ostream &amp; (*)(std::ostream &amp;))
</span></span><span class="line"><span class="cl">.text:00000000000080FC                 lea     rsi, aPleaseInputThe ; &#34;Please input the super root&#39;s password:&#34;...
</span></span><span class="line"><span class="cl">.text:0000000000008103                 mov     rdi, rax
</span></span><span class="line"><span class="cl">.text:0000000000008106                 call    __ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc ; std::operator&lt;&lt;&lt;std::char_traits&lt;char&gt;&gt;(std::ostream &amp;,char const*)
</span></span><span class="line"><span class="cl">.text:000000000000810B                 lea     rax, [rbp-90h]
</span></span><span class="line"><span class="cl">.text:0000000000008112                 mov     rsi, rax
</span></span><span class="line"><span class="cl">.text:0000000000008115                 lea     rdi, _ZSt3cin   ; std::cin
</span></span><span class="line"><span class="cl">.text:000000000000811C                 call    __ZStrsIcSt11char_traitsIcESaIcEERSt13basic_istreamIT_T0_ES7_RNSt7__cxx1112basic_stringIS4_S5_T1_EE ; std::operator&gt;&gt;&lt;char&gt;(std::istream &amp;,std::__cxx11::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt;&gt; &amp;)
</span></span><span class="line"><span class="cl">.text:0000000000008121                 jz      short near ptr loc_8125+1
</span></span><span class="line"><span class="cl">.text:0000000000008123                 jnz     short near ptr loc_8125+1
</span></span><span class="line"><span class="cl">.text:0000000000008125
</span></span><span class="line"><span class="cl">.text:0000000000008125 loc_8125:                               ; CODE XREF: .text:0000000000008121↑j
</span></span><span class="line"><span class="cl">.text:0000000000008125                                         ; .text:0000000000008123↑j
</span></span><span class="line"><span class="cl">.text:0000000000008125                 call    near ptr 70860E72h
</span></span><span class="line"><span class="cl">.text:0000000000008125 ; ---------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">.text:000000000000812A                 dw 0FFFFh, 48FFh, 0C789h
</span></span><span class="line"><span class="cl">.text:0000000000008130                 dq 0C38948FFFFB56BE8h, 48FFFFFF70858D48h, 48FFFFB489E8C789h
</span></span><span class="line"><span class="cl">.text:0000000000008130                 dq 8948B0458D48C189h, 0E8C78948CE8948DAh, 0B0458D48FFFFB584h
</span></span><span class="line"><span class="cl">.text:0000000000008130                 dq 358D480000000DBAh, 0E8C7894800007B1Dh, 840FC085FFFFB48Ch
</span></span><span class="line"><span class="cl">.text:0000000000008130                 dq 14358D48000000F6h, 0DEF63D8D4800007Bh, 48FFFFB5E1E80000h
</span></span><span class="line"><span class="cl">.text:0000000000008130                 dq 8948B0458D48C289h, 0FFB5CFE8D78948C6h, 7AFD358D48FFh
</span></span></code></pre></td></tr></table>
</div>
</div><p>问题出在了jz（为0跳转）和jnz（不为0跳转）同时存在，并插入了0xE8（call的机器码）使ida识别出错</p>
<p>解决方法先把call按u改成未定义,效果如图</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.text:0000000000008125                 db 0E8h
</span></span><span class="line"><span class="cl">.text:0000000000008126 unk_8126        db  48h ; H             ; CODE XREF: .text:0000000000008121↑j
</span></span><span class="line"><span class="cl">.text:0000000000008126                                         ; .text:0000000000008123↑j
</span></span><span class="line"><span class="cl">.text:0000000000008127                 db  8Dh
</span></span><span class="line"><span class="cl">.text:0000000000008128                 db  85h
</span></span><span class="line"><span class="cl">.text:0000000000008129                 db  70h ; p
</span></span><span class="line"><span class="cl">.text:000000000000812A                 dw 0FFFFh, 48FFh, 0C789h
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后把0xE8 patch成nop（空），其他数据按c重新分析成代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.text:0000000000008123 ; ---------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">.text:0000000000008125                 db 90h                  ; Keypatch modified this from:
</span></span><span class="line"><span class="cl">.text:0000000000008125                                         ;   db 0E8h
</span></span><span class="line"><span class="cl">.text:0000000000008125                                         ; Keypatch padded NOP to next boundary: 1 bytes
</span></span><span class="line"><span class="cl">.text:0000000000008126 ; ---------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">.text:0000000000008126
</span></span><span class="line"><span class="cl">.text:0000000000008126 loc_8126:                               ; CODE XREF: .text:0000000000008121↑j
</span></span><span class="line"><span class="cl">.text:0000000000008126                                         ; .text:0000000000008123↑j
</span></span><span class="line"><span class="cl">.text:0000000000008126                 lea     rax, [rbp-90h]
</span></span><span class="line"><span class="cl">.text:000000000000812D                 mov     rdi, rax
</span></span><span class="line"><span class="cl">.text:0000000000008130                 call    __ZNKSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEE4sizeEv ; std::__cxx11::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt;&gt;::size(void)
</span></span><span class="line"><span class="cl">.text:0000000000008135                 mov     rbx, rax
</span></span><span class="line"><span class="cl">.text:0000000000008138                 lea     rax, [rbp-90h]
</span></span><span class="line"><span class="cl">.text:000000000000813F                 mov     rdi, rax
</span></span><span class="line"><span class="cl">.text:0000000000008142                 call    __ZNKSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEE5c_strEv ; std::__cxx11::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt;&gt;::c_str(void)
</span></span><span class="line"><span class="cl">.text:0000000000008147                 mov     rcx, rax
</span></span><span class="line"><span class="cl">.text:000000000000814A                 lea     rax, [rbp-50h]
</span></span><span class="line"><span class="cl">.text:000000000000814E                 mov     rdx, rbx
</span></span><span class="line"><span class="cl">.text:0000000000008151                 mov     rsi, rcx
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后发现下面还有一个一样的错误，相同办法解决</p>
<p>最后来到函数头Create Function，</p>
<p>完事后到虚拟机上看一眼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">dx3906@ubuntu:~/Desktop$ &#39;/home/dx3906/pwn.so&#39; 
</span></span><span class="line"><span class="cl">                            &#39;--&#39;&#39;&#39;   &#39;               
</span></span><span class="line"><span class="cl">                            l__++??_&#39;&#39;               
</span></span><span class="line"><span class="cl">                            ;??JCLCQj(               
</span></span><span class="line"><span class="cl">                            ;?{BB%@@p0,^&#39;            
</span></span><span class="line"><span class="cl">                            I-{&amp;B@@B@q+&#39;-            
</span></span><span class="line"><span class="cl">                            ;?}8@%$@@Bb;- &#39;          
</span></span><span class="line"><span class="cl">                            ;?}8@$$@$$B&amp;r^-&#39;&#39;        
</span></span><span class="line"><span class="cl">                            ;?}%@@@B$$B@B8O?~:-      
</span></span><span class="line"><span class="cl">                           &#39;;?}8@B@@$@$$$$$BBpO{     
</span></span><span class="line"><span class="cl">                  &#39;    &#39;&#39;&#39; &#39;;?}8@B@BBB@@@@@B@pw(     
</span></span><span class="line"><span class="cl">                  ^l+?][I&#39;  ;?}8@@%MwOa%@@$@Bdq1     
</span></span><span class="line"><span class="cl">             &#39;&#39;,?-_?_)uZ0c~&#39;;_}%@@@MqJ^IcOwmbqq)     
</span></span><span class="line"><span class="cl">          &#39;&#39;^:?_+]w&amp;B@@@am( ;-[8@@@MqJ^   &#39;&#34;&gt;[|i     
</span></span><span class="line"><span class="cl">           ^&lt;--}MB@@@@@@am( ;-[8@$$WqJ-&#39; &#39;&#39;&#39;  &#39;&#39;     
</span></span><span class="line"><span class="cl">          &#39;?]+C%@@$@8#aobq)&#39;:_[%@@@WqU-&#39;             
</span></span><span class="line"><span class="cl">        &#39;-i]}m@BB%*qd0Q0cU}^I+[%@@@MwU-              
</span></span><span class="line"><span class="cl">        &#39;^[?n%B@@aqwL:-^&#39;-&#34;-I+[%@@@MwU-              
</span></span><span class="line"><span class="cl">         ^-_#@$$%wpx-      &#39;;+[B@@@MwU-              
</span></span><span class="line"><span class="cl">         ^]-B$@@%pq&#34;&#39;&#39;     &#39;&lt;_{8@@BMmC-              
</span></span><span class="line"><span class="cl">        -^??8$$@@kO,      &#39;---1%@$@aqU-              
</span></span><span class="line"><span class="cl">        &#39;-&gt;-#@$@BBo&gt;&#39;&#39;&#39;-&#39;^:?-?h$$$8mwt               
</span></span><span class="line"><span class="cl">          &#39;+YBB@@$8&amp;Q-!_]+_[]*$BBBqwqI               
</span></span><span class="line"><span class="cl">         &#39;&#39;&#34;[&amp;B@@$@@%8WJ/npMB%B@%qwq}                
</span></span><span class="line"><span class="cl">           &#39;&#39;;M@@@@@$@@B@@@@@@@MmpO]-&#39;               
</span></span><span class="line"><span class="cl">            &#39;^;_88@@@@B@B@$B&amp;oqqqC&#34; ^&#39;               
</span></span><span class="line"><span class="cl">               -l}mbo&amp;8&amp;&amp;oqmdwZQ:-&#39;                  
</span></span><span class="line"><span class="cl">                 -^~nOwqpZz[I&#34;&#39;&#39;                     
</span></span><span class="line"><span class="cl">                  &#39;   &#39;&#39;&#39;&#39;-&#39;&#39;&#39;                       
</span></span><span class="line"><span class="cl">    ████████╗██╗██╗  ██╗████████╗ ██████╗ ██╗  ██╗
</span></span><span class="line"><span class="cl">    ╚══██╔══╝██║██║ ██╔╝╚══██╔══╝██╔═══██╗██║ ██╔╝
</span></span><span class="line"><span class="cl">       ██║   ██║█████╔╝    ██║   ██║   ██║█████╔╝ 
</span></span><span class="line"><span class="cl">       ██║   ██║██╔═██╗    ██║   ██║   ██║██╔═██╗ 
</span></span><span class="line"><span class="cl">       ██║   ██║██║  ██╗   ██║   ╚██████╔╝██║  ██╗
</span></span><span class="line"><span class="cl">       ╚═╝   ╚═╝╚═╝  ╚═╝   ╚═╝    ╚═════╝ ╚═╝  ╚═╝
</span></span><span class="line"><span class="cl">This is the background management system for TikTok.
</span></span><span class="line"><span class="cl">PassWord:
</span></span></code></pre></td></tr></table>
</div>
</div><p>还挺不错，可惜要password</p>
<p>原本是想找一找的，结果看到代码发现我想多了，就先到这吧</p>
<h2 id="002-bjdctf-2020-老八的小汉堡">0×02 BJDCTF 2020 老八的小汉堡</h2>
<p>游戏真不错，但题实话说属于没题解不会做系列（</p>
<p>下了个dnspy，根据题解打开Data/Managed目录下的Assembly-CSharp.dll</p>
<p>搜索字符串“美汁汁”定位主函数
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-0516a67c9995408289e0b1bd19c5f1ca.png"
        data-srcset="/upload/2022/02/image-0516a67c9995408289e0b1bd19c5f1ca.png, /upload/2022/02/image-0516a67c9995408289e0b1bd19c5f1ca.png 1.5x, /upload/2022/02/image-0516a67c9995408289e0b1bd19c5f1ca.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-0516a67c9995408289e0b1bd19c5f1ca.png"
        title="image" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">public class ButtonSpawnFruit : MonoBehaviour
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    // Token: 0x0600000A RID: 10 RVA: 0x00002110 File Offset: 0x00000310
</span></span><span class="line"><span class="cl">    public static string Md5(string str)
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">        byte[] bytes = Encoding.UTF8.GetBytes(str);
</span></span><span class="line"><span class="cl">        byte[] array = MD5.Create().ComputeHash(bytes);
</span></span><span class="line"><span class="cl">        StringBuilder stringBuilder = new StringBuilder();
</span></span><span class="line"><span class="cl">        foreach (byte b in array)
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">            stringBuilder.Append(b.ToString(&#34;X2&#34;));
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        return stringBuilder.ToString().Substring(0, 20);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    // Token: 0x0600000B RID: 11 RVA: 0x00002170 File Offset: 0x00000370
</span></span><span class="line"><span class="cl">    public static string Sha1(string str)
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">        byte[] bytes = Encoding.UTF8.GetBytes(str);
</span></span><span class="line"><span class="cl">        byte[] array = SHA1.Create().ComputeHash(bytes);
</span></span><span class="line"><span class="cl">        StringBuilder stringBuilder = new StringBuilder();
</span></span><span class="line"><span class="cl">        foreach (byte b in array)
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">            stringBuilder.Append(b.ToString(&#34;X2&#34;));
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        return stringBuilder.ToString();
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    // Token: 0x0600000C RID: 12 RVA: 0x000021C8 File Offset: 0x000003C8
</span></span><span class="line"><span class="cl">    public void Spawn()
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">        FruitSpawner component = GameObject.FindWithTag(&#34;GameController&#34;).GetComponent&lt;FruitSpawner&gt;();
</span></span><span class="line"><span class="cl">        if (component)
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">            if (this.audioSources.Length != 0)
</span></span><span class="line"><span class="cl">            {
</span></span><span class="line"><span class="cl">                this.audioSources[Random.Range(0, this.audioSources.Length)].Play();
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">            component.Spawn(this.toSpawn);
</span></span><span class="line"><span class="cl">            string name = this.toSpawn.name;
</span></span><span class="line"><span class="cl">            if (name == &#34;汉堡底&#34; &amp;&amp; Init.spawnCount == 0)
</span></span><span class="line"><span class="cl">            {
</span></span><span class="line"><span class="cl">                Init.secret += 997;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">            else if (name == &#34;鸭屁股&#34;)
</span></span><span class="line"><span class="cl">            {
</span></span><span class="line"><span class="cl">                Init.secret -= 127;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">            else if (name == &#34;胡罗贝&#34;)
</span></span><span class="line"><span class="cl">            {
</span></span><span class="line"><span class="cl">                Init.secret *= 3;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">            else if (name == &#34;臭豆腐&#34;)
</span></span><span class="line"><span class="cl">            {
</span></span><span class="line"><span class="cl">                Init.secret ^= 18;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">            else if (name == &#34;俘虏&#34;)
</span></span><span class="line"><span class="cl">            {
</span></span><span class="line"><span class="cl">                Init.secret += 29;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">            else if (name == &#34;白拆&#34;)
</span></span><span class="line"><span class="cl">            {
</span></span><span class="line"><span class="cl">                Init.secret -= 47;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">            else if (name == &#34;美汁汁&#34;)
</span></span><span class="line"><span class="cl">            {
</span></span><span class="line"><span class="cl">                Init.secret *= 5;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">            else if (name == &#34;柠檬&#34;)
</span></span><span class="line"><span class="cl">            {
</span></span><span class="line"><span class="cl">                Init.secret ^= 87;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">            else if (name == &#34;汉堡顶&#34; &amp;&amp; Init.spawnCount == 5)
</span></span><span class="line"><span class="cl">            {
</span></span><span class="line"><span class="cl">                Init.secret ^= 127;
</span></span><span class="line"><span class="cl">                string str = Init.secret.ToString();
</span></span><span class="line"><span class="cl">                if (ButtonSpawnFruit.Sha1(str) == &#34;DD01903921EA24941C26A48F2CEC24E0BB0E8CC7&#34;)
</span></span><span class="line"><span class="cl">                {
</span></span><span class="line"><span class="cl">                    this.result = &#34;BJDCTF{&#34; + ButtonSpawnFruit.Md5(str) + &#34;}&#34;;
</span></span><span class="line"><span class="cl">                    Debug.Log(this.result);
</span></span><span class="line"><span class="cl">                }
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">            Init.spawnCount++;
</span></span><span class="line"><span class="cl">            Debug.Log(Init.secret);
</span></span><span class="line"><span class="cl">            Debug.Log(Init.spawnCount);
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span></code></pre></td></tr></table>
</div>
</div><p>基本思路是已知sha1(str)==DD01903921EA24941C26A48F2CEC24E0BB0E8CC7,求md5(str)</p>
<p>还是根据题解上cmd5.com得str==1001</p>
<p>然后md5加密，注意这一句，取加密后的0-20（不包括20）即前20位（前人之鉴属于是</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">return stringBuilder.ToString().Substring(0, 20)
</span></span></code></pre></td></tr></table>
</div>
</div><p>ipython跑一遍得flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">In [1]: from hashlib import md5
</span></span><span class="line"><span class="cl">In [2]: a=md5()
</span></span><span class="line"><span class="cl">In [3]: a.update(b&#34;1001&#34;)
</span></span><span class="line"><span class="cl">In [4]: print(&#34;BJDCTF{&#34;+a.hexdigest()[:20]+&#34;}&#34;)
</span></span><span class="line"><span class="cl">BJDCTF{b8c37e33defde51cf91e}
</span></span></code></pre></td></tr></table>
</div>
</div><p>总结：这周题真是给我开眼界的（</p>
<h1 id="第一周">第一周</h1>
<p>2021-10-31</p>
<p>写在前面：</p>
<ul>
<li>
<p>新人第一次发帖，多多指教</p>
</li>
<li>
<p>长篇幅警告，写得比较繁琐</p>
</li>
<li>
<p>主要记录自己的做题过程，当然还有水水水</p>
</li>
</ul>
<h2 id="0x00-dmctf-2020-re1">0x00 DMCTF 2020 re1</h2>
<blockquote>
<p>来点简单的算法甜点</p>
</blockquote>
<p>解压后只有一个exe文件，先运行看看</p>
<p>提示输入flag，乱输提示 wrong flag！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flag:134123421
</span></span><span class="line"><span class="cl">wrong flag!
</span></span><span class="line"><span class="cl">请按任意键继续. . .
</span></span></code></pre></td></tr></table>
</div>
</div><p>拖进die，无壳，进ida</p>
<p>看不懂汇编，直接F5，进main_0函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main_0</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">Str</span><span class="p">;</span> <span class="c1">// [esp+DCh] [ebp-40h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v5</span><span class="p">[</span><span class="mi">54</span><span class="p">];</span> <span class="c1">// [esp+DDh] [ebp-3Fh] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nf">__CheckForDebuggerJustMyCode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">unk_5E0029</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">Str</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">j__memset</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">v5</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="nf">sub_485257</span><span class="p">(</span><span class="s">&#34;flag:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">sub_484CF3</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dword_5DD268</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="nf">sub_485D1A</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Str</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sub_4849EC</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sub_485257</span><span class="p">(</span><span class="s">&#34;wrong flag!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">sub_488209</span><span class="p">(</span><span class="s">&#34;pause&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>发现有用的主要在if else</p>
<p>先进if判断条件函数sub_485D1A</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">BOOL</span> <span class="kr">__cdecl</span> <span class="nf">sub_49BE80</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">Str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">__CheckForDebuggerJustMyCode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">unk_5E0029</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nf">j__strlen</span><span class="p">(</span><span class="n">Str</span><span class="p">)</span> <span class="o">==</span> <span class="mi">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>第一行看不懂也感觉没用，直接忽略，第二行限制输入为20个字符</p>
<p>回来再进if下函数sub_4849EC</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">int __cdecl sub_49AE10(char *Str1)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  int result; // eax
</span></span><span class="line"><span class="cl">  int i; // [esp+D0h] [ebp-2Ch]
</span></span><span class="line"><span class="cl">  char Str2[28]; // [esp+DCh] [ebp-20h] BYREF
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  __CheckForDebuggerJustMyCode(&amp;unk_5E0029);
</span></span><span class="line"><span class="cl">  strcpy(Str2, &#34;fmesh{umkc_vlrn_glh}&#34;);
</span></span><span class="line"><span class="cl">  for ( i = 0; i &lt;= 19; ++i )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    if ( Str1[i] &lt; 97 || Str1[i] &gt;= 108 )
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      if ( Str1[i] &gt; 110 &amp;&amp; Str1[i] &lt;= 122 )
</span></span><span class="line"><span class="cl">        --Str1[i];
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    else
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      Str1[i] += 2;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  if ( !j__strcmp(Str1, Str2) )
</span></span><span class="line"><span class="cl">    result = sub_485257(&#34;congratulations!\n&#34;);
</span></span><span class="line"><span class="cl">  else
</span></span><span class="line"><span class="cl">    result = sub_485257(&#34;wrong flag!\n&#34;);
</span></span><span class="line"><span class="cl">  return result;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>发现是个简单的加密</p>
<p>加改成减，减改成加，逆写得到flag，粘个代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&lt;cstdio&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">char</span> <span class="n">Str1</span><span class="p">[]</span><span class="o">=</span><span class="s">&#34;fmesh{umkc_vlrn_glh}&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">19</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="n">Str1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">97</span> <span class="o">||</span> <span class="n">Str1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">108</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span> <span class="n">Str1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">110</span> <span class="o">&amp;&amp;</span> <span class="n">Str1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">122</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">Str1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">Str1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="n">Str1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//flag:dmctf{vmia_wlsn_elf}
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>然而据说这题多解，咱也不知道，咱也不敢问</p>
<h3 id="0x01-dmctf-2020-re4">0x01 DMCTF 2020 re4</h3>
<blockquote>
<p>“最短路径”</p>
</blockquote>
<p>直接打开exe，输入key闪退差评</p>
<p>cmd打开</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\Users\DX3906&gt;D:\DX3906\下载\12345\12345.exe
</span></span><span class="line"><span class="cl">key:1234123
</span></span><span class="line"><span class="cl">failed.
</span></span><span class="line"><span class="cl">failed.
</span></span><span class="line"><span class="cl">failed.
</span></span><span class="line"><span class="cl">failed.
</span></span><span class="line"><span class="cl">failed.
</span></span><span class="line"><span class="cl">failed.
</span></span><span class="line"><span class="cl">failed.
</span></span><span class="line"><span class="cl">failed.
</span></span></code></pre></td></tr></table>
</div>
</div><p>8个failed直呼好狠</p>
<p>die查壳：无，拖进ida</p>
<p>直接F5，找不到主函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">__noreturn</span> <span class="nf">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">_set_app_type</span><span class="p">(</span><span class="n">_crt_console_app</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">sub_4011B0</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>打开string窗口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.rdata:00405000    00000013    C    libgcc_s_dw2-1.dll
</span></span><span class="line"><span class="cl">.rdata:00405013    00000016    C    __register_frame_info
</span></span><span class="line"><span class="cl">.rdata:00405029    00000018    C    __deregister_frame_info
</span></span><span class="line"><span class="cl">.rdata:00405041    0000000E    C    libgcj-16.dll
</span></span><span class="line"><span class="cl">.rdata:0040504F    00000014    C    _Jv_RegisterClasses
</span></span><span class="line"><span class="cl">.rdata:0040506A    00000008    C    failed.
</span></span><span class="line"><span class="cl">.rdata:00405072    0000000A    C    flag{%s}\n
</span></span><span class="line"><span class="cl">.rdata:00405080    00000018    C    Mingw runtime failure:\n
</span></span><span class="line"><span class="cl">.rdata:00405098    00000031    C      VirtualQuery failed for %d bytes at address %p
</span></span><span class="line"><span class="cl">.rdata:004050CC    00000032    C      Unknown pseudo relocation protocol version %d.\n
</span></span><span class="line"><span class="cl">.rdata:00405100    0000002A    C      Unknown pseudo relocation bit size %d.\n
</span></span></code></pre></td></tr></table>
</div>
</div><p>映入眼帘就是failed</p>
<p>点他——</p>
<p><code>rdata:0040506A Buffer          db 'failed.',0          ; DATA XREF: sub_401460:loc_4015A3↑o</code></p>
<p>发现函数sub_401460，点他弹出来汇编，再F5，终于进了真的主函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">sub_401460</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">v0</span><span class="p">;</span> <span class="c1">// eax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">Buffer</span><span class="p">[</span><span class="mi">51</span><span class="p">];</span> <span class="c1">// [esp+3Dh] [ebp-43h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [esp+70h] [ebp-10h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [esp+74h] [ebp-Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [esp+78h] [ebp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [esp+7Ch] [ebp-4h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nf">sub_401BD0</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;key:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">fgets</span><span class="p">(</span><span class="n">Buffer</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="p">(</span><span class="n">FILE</span> <span class="o">*</span><span class="p">)</span><span class="n">iob</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">_ptr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span> <span class="o">=</span> <span class="nf">strlen</span><span class="p">(</span><span class="n">Buffer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">Buffer</span><span class="p">[</span><span class="n">v3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Buffer</span><span class="p">[</span><span class="n">v3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">--</span><span class="n">v3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v0</span> <span class="o">=</span> <span class="n">Buffer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="n">v0</span> <span class="o">==</span> <span class="mh">0x31</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="o">--</span><span class="n">v5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">v0</span> <span class="o">&gt;</span> <span class="mi">49</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="n">v0</span> <span class="o">==</span> <span class="mi">50</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="o">++</span><span class="n">v6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="n">v0</span> <span class="o">!=</span> <span class="mi">51</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nl">LABEL_16</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">          <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;failed.&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="k">goto</span> <span class="n">LABEL_17</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">--</span><span class="n">v6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="n">v0</span> <span class="o">!=</span> <span class="mi">48</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">goto</span> <span class="n">LABEL_16</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="o">++</span><span class="n">v5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nl">LABEL_17</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">byte_404020</span><span class="p">[</span><span class="mi">10</span> <span class="o">*</span> <span class="n">v6</span> <span class="o">+</span> <span class="n">v5</span><span class="p">]</span> <span class="o">||</span> <span class="n">v6</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">v5</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">v6</span> <span class="o">&gt;</span> <span class="mi">9</span> <span class="o">||</span> <span class="n">v5</span> <span class="o">&gt;</span> <span class="mi">9</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;failed.&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">v6</span> <span class="o">==</span> <span class="mi">9</span> <span class="o">&amp;&amp;</span> <span class="n">v5</span> <span class="o">==</span> <span class="mi">9</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;flag{%s}</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">Buffer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>观察LABEL_17中if的判断条件，咋看咋像迷宫题，v6表示行，v5表示列，0-9共10行10列</p>
<p>进数组byte_404020，数据都是0和1，更加确信迷宫</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.data:00404020 byte_404020     db 1                    ; DATA XREF: sub_401460+164↑r
</span></span><span class="line"><span class="cl">.data:00404021                 db    0
</span></span><span class="line"><span class="cl">.data:00404022                 db    0
</span></span><span class="line"><span class="cl">.data:00404023                 db    0
</span></span><span class="line"><span class="cl">.data:00404024                 db    0
</span></span><span class="line"><span class="cl">.data:00404025                 db    1
</span></span><span class="line"><span class="cl">.data:00404026                 db    1
</span></span><span class="line"><span class="cl">.data:00404027                 db    0
</span></span><span class="line"><span class="cl">.data:00404028                 db    0
</span></span><span class="line"><span class="cl">.data:00404029                 db    0
</span></span><span class="line"><span class="cl">.data:0040402A                 db    1
</span></span><span class="line"><span class="cl">.data:0040402B                 db    1
</span></span><span class="line"><span class="cl">.data:0040402C                 db    0
</span></span><span class="line"><span class="cl">.data:0040402D                 db    0
</span></span><span class="line"><span class="cl">.data:0040402E                 db    0
</span></span><span class="line"><span class="cl">.data:0040402F                 db    1
</span></span><span class="line"><span class="cl">.data:00404030                 db    1
</span></span><span class="line"><span class="cl">.data:00404031                 db    1
</span></span><span class="line"><span class="cl">.data:00404032                 db    0
</span></span></code></pre></td></tr></table>
</div>
</div><p>但，这要我一个个扣出来？？</p>
<p>右键选择Array</p>
<p>然后把size改成100（10行10列共100个数</p>
<p>舒服~</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.data:00404020 byte_404020     db 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1; 0
</span></span><span class="line"><span class="cl">.data:00404020                                         ; DATA XREF: sub_401460+164↑r
</span></span><span class="line"><span class="cl">.data:00404020                 db 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1; 18
</span></span><span class="line"><span class="cl">.data:00404020                 db 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0; 36
</span></span><span class="line"><span class="cl">.data:00404020                 db 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0; 54
</span></span><span class="line"><span class="cl">.data:00404020                 db 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1; 72
</span></span><span class="line"><span class="cl">.data:00404020                 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 1; 90
</span></span></code></pre></td></tr></table>
</div>
</div><p>复制粘贴出迷宫</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 
</span></span><span class="line"><span class="cl">1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 
</span></span><span class="line"><span class="cl">0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 
</span></span><span class="line"><span class="cl">0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 
</span></span><span class="line"><span class="cl">0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 
</span></span><span class="line"><span class="cl">0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 
</span></span><span class="line"><span class="cl">0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 
</span></span><span class="line"><span class="cl">0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 
</span></span><span class="line"><span class="cl">0, 0, 0, 0, 0, 0, 0, 0, 1, 1,
</span></span><span class="line"><span class="cl">0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
</span></span></code></pre></td></tr></table>
</div>
</div><p>回头再看函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">for ( i = 0; i &lt; v3; ++i )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    v0 = Buffer[i];
</span></span><span class="line"><span class="cl">    if ( v0 == 0x31 )
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      --v5;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    else if ( v0 &gt; 49 )
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      if ( v0 == 50 )
</span></span><span class="line"><span class="cl">      {
</span></span><span class="line"><span class="cl">        ++v6;
</span></span><span class="line"><span class="cl">      }
</span></span><span class="line"><span class="cl">      else
</span></span><span class="line"><span class="cl">      {
</span></span><span class="line"><span class="cl">        if ( v0 != 51 )
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">LABEL_16:
</span></span><span class="line"><span class="cl">          puts(&#34;failed.&#34;);
</span></span><span class="line"><span class="cl">          goto LABEL_17;
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        --v6;
</span></span><span class="line"><span class="cl">      }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    else
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      if ( v0 != 48 )
</span></span><span class="line"><span class="cl">        goto LABEL_16;
</span></span><span class="line"><span class="cl">      ++v5;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">LABEL_17:
</span></span><span class="line"><span class="cl">    if ( !byte_404020[10 * v6 + v5] || v6 &lt; 0 || v5 &lt; 0 || v6 &gt; 9 || v5 &gt; 9 )
</span></span><span class="line"><span class="cl">      puts(&#34;failed.&#34;);
</span></span><span class="line"><span class="cl">  }
</span></span></code></pre></td></tr></table>
</div>
</div><p>易得</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">0    ++v5    right
</span></span><span class="line"><span class="cl">1    --v5    left
</span></span><span class="line"><span class="cl">2    ++v6    down
</span></span><span class="line"><span class="cl">3    --v6    up
</span></span></code></pre></td></tr></table>
</div>
</div><p>手动走迷宫得 key:20220002033330202222202202</p>
<p>回cmd运行得flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">key:20220002033330202222202202
</span></span><span class="line"><span class="cl">flag{20220002033330202222202202}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="0x02-gwctf-2019-xxor">0x02 GWCTF 2019 xxor</h2>
<blockquote>
<p>快乐的解方程题目</p>
</blockquote>
<p>解压打开发现不是exe，无法打开直接拖die</p>
<p>发现是elf64（linux可执行文件），马上去开虚拟机</p>
<p>ubuntu里先运行一下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">dx3906@ubuntu:~/Desktop$ &#39;/home/dx3906/attachment&#39; 
</span></span><span class="line"><span class="cl">Let us play a game?
</span></span><span class="line"><span class="cl">you have six chances to input
</span></span><span class="line"><span class="cl">Come on!
</span></span><span class="line"><span class="cl">input: 1231212
</span></span><span class="line"><span class="cl">input: 3
</span></span><span class="line"><span class="cl">input: 12
</span></span><span class="line"><span class="cl">input: 3
</span></span><span class="line"><span class="cl">input: 12
</span></span><span class="line"><span class="cl">input: 3
</span></span><span class="line"><span class="cl">Wrong!
</span></span><span class="line"><span class="cl">NO NO NO~
</span></span></code></pre></td></tr></table>
</div>
</div><p>发现题目需要输入六次，拖ida F5</p>
<p>在左边Functions Window找到了main函数，竟然是真的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">__int64 __fastcall main(int a1, char **a2, char **a3)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  int i; // [rsp+8h] [rbp-68h]
</span></span><span class="line"><span class="cl">  int j; // [rsp+Ch] [rbp-64h]
</span></span><span class="line"><span class="cl">  __int64 v6[6]; // [rsp+10h] [rbp-60h] BYREF
</span></span><span class="line"><span class="cl">  __int64 v7[6]; // [rsp+40h] [rbp-30h] BYREF
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  v7[5] = __readfsqword(0x28u);
</span></span><span class="line"><span class="cl">  puts(&#34;Let us play a game?&#34;);
</span></span><span class="line"><span class="cl">  puts(&#34;you have six chances to input&#34;);
</span></span><span class="line"><span class="cl">  puts(&#34;Come on!&#34;);
</span></span><span class="line"><span class="cl">  v6[0] = 0LL;
</span></span><span class="line"><span class="cl">  v6[1] = 0LL;
</span></span><span class="line"><span class="cl">  v6[2] = 0LL;
</span></span><span class="line"><span class="cl">  v6[3] = 0LL;
</span></span><span class="line"><span class="cl">  v6[4] = 0LL;
</span></span><span class="line"><span class="cl">  for ( i = 0; i &lt;= 5; ++i )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    printf(&#34;%s&#34;, &#34;input: &#34;);
</span></span><span class="line"><span class="cl">    __isoc99_scanf(&#34;%d&#34;, (char *)v6 + 4 * i);
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  v7[0] = 0LL;
</span></span><span class="line"><span class="cl">  v7[1] = 0LL;
</span></span><span class="line"><span class="cl">  v7[2] = 0LL;
</span></span><span class="line"><span class="cl">  v7[3] = 0LL;
</span></span><span class="line"><span class="cl">  v7[4] = 0LL;
</span></span><span class="line"><span class="cl">  for ( j = 0; j &lt;= 2; ++j )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    dword_601078 = v6[j];
</span></span><span class="line"><span class="cl">    dword_60107C = HIDWORD(v6[j]);
</span></span><span class="line"><span class="cl">    sub_400686(&amp;dword_601078, &amp;unk_601060);
</span></span><span class="line"><span class="cl">    LODWORD(v7[j]) = dword_601078;
</span></span><span class="line"><span class="cl">    HIDWORD(v7[j]) = dword_60107C;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  if ( (unsigned int)sub_400770(v7) != 1 )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    puts(&#34;NO NO NO~ &#34;);
</span></span><span class="line"><span class="cl">    exit(0);
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  puts(&#34;Congratulation!\n&#34;);
</span></span><span class="line"><span class="cl">  puts(&#34;You seccess half\n&#34;);
</span></span><span class="line"><span class="cl">  puts(&#34;Do not forget to change input to hex and combine~\n&#34;);
</span></span><span class="line"><span class="cl">  puts(&#34;ByeBye&#34;);
</span></span><span class="line"><span class="cl">  return 0LL;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>倒着看，先进if里面的判断函数sub_400770(v7)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">__int64 __fastcall sub_400770(_DWORD *a1)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  __int64 result; // rax
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  if ( a1[2] - a1[3] == 0x84A236FFLL
</span></span><span class="line"><span class="cl">    &amp;&amp; a1[3] + a1[4] == 0xFA6CB703LL
</span></span><span class="line"><span class="cl">    &amp;&amp; a1[2] - a1[4] == 0x42D731A8LL
</span></span><span class="line"><span class="cl">    &amp;&amp; *a1 == 0xDF48EF7E
</span></span><span class="line"><span class="cl">    &amp;&amp; a1[5] == 0x84F30420
</span></span><span class="line"><span class="cl">    &amp;&amp; a1[1] == 0x20CAACF4 )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    puts(&#34;good!&#34;);
</span></span><span class="line"><span class="cl">    result = 1LL;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  else
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    puts(&#34;Wrong!&#34;);
</span></span><span class="line"><span class="cl">    result = 0LL;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  return result;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>果然如题目解方程，z3搞它</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">z3</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="mh">0xDF48EF7E</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="mh">0x20CAACF4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span> <span class="o">==</span> <span class="mh">0x84F30420</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">d</span> <span class="o">==</span> <span class="mh">0x84A236FF</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="n">e</span> <span class="o">==</span> <span class="mh">0xFA6CB703</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">e</span> <span class="o">==</span> <span class="mh">0x42D731A8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">check</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">model</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>a-f表示a1的0-5，z3里不会定义数组，干脆用字母，会的佬教一下孩子</p>
<p>得到结果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sat
</span></span><span class="line"><span class="cl">[c = 3774025685,
</span></span><span class="line"><span class="cl"> d = 1548802262,
</span></span><span class="line"><span class="cl"> e = 2652626477,
</span></span><span class="line"><span class="cl"> f = 2230518816,
</span></span><span class="line"><span class="cl"> b = 550153460,
</span></span><span class="line"><span class="cl"> a = 3746099070]
</span></span></code></pre></td></tr></table>
</div>
</div><p>但这还没完（要是光解方程可能也做不了第三题</p>
<p>解出来的是加密后的input，加密算法如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  for ( j = 0; j &lt;= 2; ++j )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    dword_601078 = v6[j];
</span></span><span class="line"><span class="cl">    dword_60107C = HIDWORD(v6[j]);
</span></span><span class="line"><span class="cl">    sub_400686(&amp;dword_601078, &amp;unk_601060);
</span></span><span class="line"><span class="cl">    LODWORD(v7[j]) = dword_601078;
</span></span><span class="line"><span class="cl">    HIDWORD(v7[j]) = dword_60107C;
</span></span><span class="line"><span class="cl">  }
</span></span></code></pre></td></tr></table>
</div>
</div><p>基本是把高四字节（HIDWORD）和低四字节（LODWORD）分开一顿操作，进函数sub_400686</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">__int64 __fastcall sub_400686(unsigned int *a1, _DWORD *a2)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  __int64 result; // rax
</span></span><span class="line"><span class="cl">  unsigned int v3; // [rsp+1Ch] [rbp-24h]
</span></span><span class="line"><span class="cl">  unsigned int v4; // [rsp+20h] [rbp-20h]
</span></span><span class="line"><span class="cl">  int v5; // [rsp+24h] [rbp-1Ch]
</span></span><span class="line"><span class="cl">  unsigned int i; // [rsp+28h] [rbp-18h]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  v3 = *a1;
</span></span><span class="line"><span class="cl">  v4 = a1[1];
</span></span><span class="line"><span class="cl">  v5 = 0;
</span></span><span class="line"><span class="cl">  for ( i = 0; i &lt;= 0x3F; ++i )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    v5 += 0x458BCD42;
</span></span><span class="line"><span class="cl">    v3 += (v4 + v5 + 11) ^ ((v4 &lt;&lt; 6) + *a2) ^ ((v4 &gt;&gt; 9) + a2[1]) ^ 0x20;
</span></span><span class="line"><span class="cl">    v4 += (v3 + v5 + 20) ^ ((v3 &lt;&lt; 6) + a2[2]) ^ ((v3 &gt;&gt; 9) + a2[3]) ^ 0x10;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  *a1 = v3;
</span></span><span class="line"><span class="cl">  result = v4;
</span></span><span class="line"><span class="cl">  a1[1] = v4;
</span></span><span class="line"><span class="cl">  return result;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>感觉好像我的二面题，tea加密？</p>
<p>变量只有v3，v4，且求v3时v4已知，求v4时v3已知</p>
<p>结论：可逆，难点在于各种数据类型容易把自己搞晕</p>
<p>注意主函数input格式控制为%d，故用int存flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">__isoc99_scanf(&#34;%d&#34;, (char *)v6 + 4 * i);
</span></span></code></pre></td></tr></table>
</div>
</div><p>完整代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&lt;cstdio&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">flag</span><span class="p">[</span><span class="mi">100</span><span class="p">],</span><span class="n">a1</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="mi">3746099070</span><span class="p">,</span><span class="mi">550153460</span><span class="p">,</span><span class="mi">3774025685</span><span class="p">,</span><span class="mi">1548802262</span><span class="p">,</span><span class="mi">2652626477</span><span class="p">,</span><span class="mi">2230518816</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">a2</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">v5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=*</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="o">*</span><span class="p">)</span><span class="n">a1</span><span class="o">+</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">xl</span><span class="o">=*</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="c1">//低位 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">xh</span><span class="o">=*</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="c1">//高位 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mh">0x3F</span><span class="p">;</span><span class="n">j</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">--</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="n">v5</span><span class="o">=</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mh">0x458BCD42</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">xh</span><span class="o">-=</span><span class="p">(</span><span class="n">xl</span><span class="o">+</span><span class="n">v5</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span><span class="o">^</span><span class="p">((</span><span class="n">xl</span><span class="o">&lt;&lt;</span><span class="mi">6</span><span class="p">)</span><span class="o">+</span><span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">^</span><span class="p">((</span><span class="n">xl</span><span class="o">&gt;&gt;</span><span class="mi">9</span><span class="p">)</span><span class="o">+</span><span class="n">key</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">^</span><span class="mh">0x10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">xl</span><span class="o">-=</span><span class="p">(</span><span class="n">xh</span><span class="o">+</span><span class="n">v5</span><span class="o">+</span><span class="mi">11</span><span class="p">)</span><span class="o">^</span><span class="p">((</span><span class="n">xh</span><span class="o">&lt;&lt;</span><span class="mi">6</span><span class="p">)</span><span class="o">+</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">^</span><span class="p">((</span><span class="n">xh</span><span class="o">&gt;&gt;</span><span class="mi">9</span><span class="p">)</span><span class="o">+</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">^</span><span class="mh">0x20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">xl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">xh</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>输出6个数字</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">6712417
</span></span><span class="line"><span class="cl">6781810
</span></span><span class="line"><span class="cl">6643561
</span></span><span class="line"><span class="cl">7561063
</span></span><span class="line"><span class="cl">7497057
</span></span><span class="line"><span class="cl">7610749
</span></span></code></pre></td></tr></table>
</div>
</div><p>回 Ubuntu input</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">dx3906@ubuntu:~/Desktop$ &#39;/home/dx3906/attachment&#39; 
</span></span><span class="line"><span class="cl">Let us play a game?
</span></span><span class="line"><span class="cl">you have six chances to input
</span></span><span class="line"><span class="cl">Come on!
</span></span><span class="line"><span class="cl">input: 6712417
</span></span><span class="line"><span class="cl">input: 6781810
</span></span><span class="line"><span class="cl">input: 6643561
</span></span><span class="line"><span class="cl">input: 7561063
</span></span><span class="line"><span class="cl">input: 7497057
</span></span><span class="line"><span class="cl">input: 7610749
</span></span><span class="line"><span class="cl">good!
</span></span><span class="line"><span class="cl">Congratulation!
</span></span><span class="line"><span class="cl">You seccess half
</span></span><span class="line"><span class="cl">Do not forget to change input to hex and combine~
</span></span><span class="line"><span class="cl">ByeBye
</span></span></code></pre></td></tr></table>
</div>
</div><p>成功了，但还没有完全成功</p>
<p>hex？？？百度先</p>
<p>偷懒得flag，真香</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/upload/2022/02/image-44c372607bfe4868b41323a4c74e405f.png"
        data-srcset="/upload/2022/02/image-44c372607bfe4868b41323a4c74e405f.png, /upload/2022/02/image-44c372607bfe4868b41323a4c74e405f.png 1.5x, /upload/2022/02/image-44c372607bfe4868b41323a4c74e405f.png 2x"
        data-sizes="auto"
        alt="/upload/2022/02/image-44c372607bfe4868b41323a4c74e405f.png"
        title="image" /></p>
<p>当然还是要认真学一学（</p>
<p><a href="https://zhuanlan.zhihu.com/p/344477237" title="Base64与Hex编码" target="_blank" rel="noopener noreffer ">Base64与Hex编码</a></p>
<p>最后，手写解码奉上(使用上一段代码的flag数组)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">bool f=0;
</span></span><span class="line"><span class="cl">int t,cnt=0,ans[10];
</span></span><span class="line"><span class="cl">for(int i=0;i&lt;6;i++){
</span></span><span class="line"><span class="cl">    cnt=0;
</span></span><span class="line"><span class="cl">    while(flag[i]){
</span></span><span class="line"><span class="cl">        if(!f){
</span></span><span class="line"><span class="cl">            t=flag[i]%16;
</span></span><span class="line"><span class="cl">            flag[i]/=16;
</span></span><span class="line"><span class="cl">            f=1;
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        if(f){
</span></span><span class="line"><span class="cl">            t+=flag[i]%16&lt;&lt;4;
</span></span><span class="line"><span class="cl">            flag[i]/=16;
</span></span><span class="line"><span class="cl">            ans[++cnt]=t;
</span></span><span class="line"><span class="cl">            f=0;
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    for(int j=cnt;j&gt;=1;j--){
</span></span><span class="line"><span class="cl">        printf(&#34;%c&#34;,ans[j]);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2022-02-08</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/2022/02/%E5%BC%BA%E5%A3%AE%E9%80%86%E5%90%91%E4%BA%BA-wp/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://blog.dx39061.top/2022/02/%E5%BC%BA%E5%A3%AE%E9%80%86%E5%90%91%E4%BA%BA-wp/" data-title="强壮逆向人wp" data-hashtags="CTF,reverse"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://blog.dx39061.top/2022/02/%E5%BC%BA%E5%A3%AE%E9%80%86%E5%90%91%E4%BA%BA-wp/" data-hashtag="CTF"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://blog.dx39061.top/2022/02/%E5%BC%BA%E5%A3%AE%E9%80%86%E5%90%91%E4%BA%BA-wp/" data-title="强壮逆向人wp"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://blog.dx39061.top/2022/02/%E5%BC%BA%E5%A3%AE%E9%80%86%E5%90%91%E4%BA%BA-wp/" data-title="强壮逆向人wp"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://blog.dx39061.top/2022/02/%E5%BC%BA%E5%A3%AE%E9%80%86%E5%90%91%E4%BA%BA-wp/" data-title="强壮逆向人wp"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/ctf/">CTF</a>,&nbsp;<a href="/tags/reverse/">reverse</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav">
            <a href="/2022/02/regular-expressionlinux/" class="next" rel="next" title="Regular Expression（linux）">Regular Expression（linux）<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="giscus" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://giscus.app">Giscus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.109.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/DX39061" target="_blank">DX3906</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/index.umd.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":70},"comment":{"giscus":{"category":"General","categoryId":"DIC_kwDOIfJDVM4CTZ0v","darkTheme":"dark","emitMetadata":"0","inputPosition":"bottom","lang":"zh-CN","lazyLoading":false,"lightTheme":"light","mapping":"pathname","reactionsEnabled":"1","repo":"DX39061/DX39061.github.io","repoId":"R_kgDOIfJDVA"}},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"data":{"id-1":"DX3906's blog","id-2":"DX3906's blog"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":true,"left":"$$","right":"$$"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"},{"display":false,"left":"$","right":"$"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-PDDZEGMRFE', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-PDDZEGMRFE" async></script></body>
</html>
